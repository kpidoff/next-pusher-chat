{"version":3,"sources":["../src/server/api/auth/route.ts","../src/server/api/events/route.ts","../src/server/api/index.ts","../src/client/utils/logger.ts","../src/server/service/event.ts","../src/adapters/pages-router.ts","../src/client/services/chat/event.ts","../src/client/hooks/useChatSubscribe.ts","../src/client/services/chat/subscribe.ts","../src/client/providers/NextPusherChatProvider.tsx","../src/client/services/pusher/subscribe.ts","../src/client/hooks/useChat.ts","../src/client/contexts/ChatContext.tsx","../src/client/constants/constants.ts","../src/client/utils/config.ts","../src/client/components/Chat/style.ts","../src/client/components/Chat/components/ChatActions/style.ts","../src/client/components/Chat/components/ChatActions/index.tsx","../src/client/components/Chat/components/LoadMoreMessages/style.ts","../src/client/components/Chat/components/LoadMoreMessages/index.tsx","../src/client/components/Chat/components/MessageInput/style.ts","../src/client/components/Chat/components/MessageInput/index.tsx","../src/client/components/Chat/components/EmojiPicker/index.tsx","../src/client/components/Chat/components/FileList/index.tsx","../src/client/components/Chat/components/FilePicker/index.tsx","../src/client/components/Chat/components/VoiceRecorder/index.tsx","../src/client/components/Chat/components/MessageList/index.tsx","../src/client/components/Chat/components/MessageList/styles.ts","../src/client/components/Chat/components/MessageBubble/index.tsx","../src/client/components/Chat/components/MessageBubble/style.ts","../src/client/utils/fileUtils.ts","../src/client/components/Chat/components/MessageList/AudioMessage.tsx","../src/client/components/Chat/components/MessageList/ImageFile.tsx","../src/client/components/Chat/components/MessageList/ImageViewer.tsx","../src/client/components/Chat/components/MessageList/RegularFile.tsx","../src/client/components/Chat/components/MessageList/MessageFiles.tsx","../src/client/components/Chat/components/SeenBy/index.tsx","../src/client/components/Chat/components/SeenBy/style.ts","../src/client/components/Chat/components/UserAvatar/index.tsx","../src/client/utils/color.ts","../src/client/components/Chat/components/TypingIndicator/index.tsx","../src/client/components/Chat/components/TypingIndicator/styles.ts","../src/client/components/Chat/index.tsx","../src/client/components/ChatBubble/index.tsx","../src/client/components/ChatPopup/index.tsx","../src/client/components/ChatPopup/components/Header/index.tsx","../src/client/components/ChatPopup/components/Header/DocumentsMenu/index.tsx","../src/client/components/ChatPopup/components/Header/DocumentsMenu/styles.ts","../src/client/components/FileManager/styles.ts","../src/client/components/FileManager/FileItem.tsx","../src/client/components/ChatPopup/components/Header/HeaderMenu.tsx","../src/client/components/ChatPopup/components/Header/ParticipantsMenu/index.tsx","../src/client/components/ChatPopup/components/Header/ParticipantsMenu/styles.ts","../src/client/components/ChatPopup/style.ts","../src/client/components/FloatingButton/index.tsx","../src/client/components/FloatingButton/styles.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\r\nimport Pusher from 'pusher';\r\n\r\nconst pusher = new Pusher({\r\n  appId: process.env.PUSHER_APP_ID!,\r\n  key: process.env.NEXT_PUBLIC_PUSHER_KEY!,\r\n  secret: process.env.PUSHER_SECRET!,\r\n  cluster: process.env.NEXT_PUBLIC_PUSHER_CLUSTER!,\r\n});\r\n\r\nexport async function POST(request: NextRequest) {\r\n  const requestData = await request.formData();\r\n  const socketId = requestData.get('socket_id') as string;\r\n  const channel = requestData.get('channel_name') as string;\r\n  const userId = request.headers.get('x-user-id');\r\n\r\n  if (!socketId || !channel || !userId) {\r\n    return new Response(JSON.stringify({ error: 'Paramètres manquants' }), {\r\n      status: 400,\r\n      headers: { 'Content-Type': 'application/json' },\r\n    });\r\n  }\r\n\r\n  try {\r\n    if (!channel.startsWith('private-')) {\r\n      return new Response(JSON.stringify({ error: 'Canal non autorisé' }), {\r\n        status: 403,\r\n        headers: { 'Content-Type': 'application/json' },\r\n      });\r\n    }\r\n\r\n    const auth = pusher.authorizeChannel(socketId, channel);\r\n    return new Response(JSON.stringify(auth), {\r\n      headers: { 'Content-Type': 'application/json' },\r\n    });\r\n  } catch (err) {\r\n    console.error(\"⚠️ Auth failed:\", err);\r\n    return new Response(\r\n      JSON.stringify({\r\n        error: \"Échec de l'authentification\",\r\n        details: err instanceof Error ? err.message : \"Inconnu\",\r\n      }),\r\n      { status: 401, headers: { \"Content-Type\": \"application/json\" } }\r\n    );\r\n  }\r\n} ","import { NextRequest } from 'next/server';\r\nimport Pusher from 'pusher';\r\n\r\nconst pusher = new Pusher({\r\n  appId: process.env.PUSHER_APP_ID!,\r\n  key: process.env.NEXT_PUBLIC_PUSHER_KEY!,\r\n  secret: process.env.PUSHER_SECRET!,\r\n  cluster: process.env.NEXT_PUBLIC_PUSHER_CLUSTER!,\r\n});\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { event, channel, data } = await request.json();\r\n\r\n    if (!event || !channel || !data) {\r\n      return new Response(JSON.stringify({ error: 'Event, channel, and data are required' }), {\r\n        status: 400,\r\n        headers: { 'Content-Type': 'application/json' },\r\n      });\r\n    }\r\n\r\n    const result = await pusher.trigger(channel, event, data);\r\n    return new Response(JSON.stringify(result), {\r\n      headers: { 'Content-Type': 'application/json' },\r\n    });\r\n  } catch (error) {\r\n    console.error('Error in POST /api/chat:', error);\r\n    return new Response(JSON.stringify({ \r\n      error: 'Internal Server Error',\r\n      details: error instanceof Error ? error.message : 'Unknown error'\r\n    }), {\r\n      status: 500,\r\n      headers: { 'Content-Type': 'application/json' },\r\n    });\r\n  }\r\n} ","import { NextRequest } from \"next/server\";\r\nimport { POST as POST_AUTH } from \"./auth/route\";\r\nimport { POST as POST_EVENTS } from \"./events/route\";\r\n\r\nexport async function POST(request: NextRequest) {\r\n    const contentType = request.headers.get(\"content-type\") || \"\";\r\n    // Si c'est une requête form-data, c'est une demande d'authentification\r\n    if (contentType.includes(\"application/x-www-form-urlencoded\")) {\r\n      return POST_AUTH(request);\r\n    }\r\n  \r\n    // Sinon, c'est une requête pour déclencher un événement\r\n    return POST_EVENTS(request);\r\n  }","type LogLevel = 'debug' | 'info' | 'warn' | 'error';\r\n\r\ninterface LoggerConfig {\r\n  enabled: boolean;\r\n  level: LogLevel;\r\n}\r\n\r\nclass Logger {\r\n  private config: LoggerConfig;\r\n\r\n  constructor() {\r\n    this.config = {\r\n      enabled: process.env.NEXT_PUBLIC_ENABLE_LOGS === 'true',\r\n      level: (process.env.NEXT_PUBLIC_LOG_LEVEL as LogLevel) || 'info',\r\n    };\r\n  }\r\n\r\n  private shouldLog(level: LogLevel): boolean {\r\n    if (!this.config.enabled) return false;\r\n\r\n    const levels: LogLevel[] = ['debug', 'info', 'warn', 'error'];\r\n    return levels.indexOf(level) >= levels.indexOf(this.config.level);\r\n  }\r\n\r\n  private formatMessage(level: LogLevel, message: string, ...args: any[]): string {\r\n    return `[${level.toUpperCase()}] ${message}`;\r\n  }\r\n\r\n  debug(message: string, ...args: any[]): void {\r\n    if (this.shouldLog('debug')) {\r\n      console.debug(this.formatMessage('debug', message), ...args);\r\n    }\r\n  }\r\n\r\n  info(message: string, ...args: any[]): void {\r\n    if (this.shouldLog('info')) {\r\n      console.info(this.formatMessage('info', message), ...args);\r\n    }\r\n  }\r\n\r\n  warn(message: string, ...args: any[]): void {\r\n    if (this.shouldLog('warn')) {\r\n      console.warn(this.formatMessage('warn', message), ...args);\r\n    }\r\n  }\r\n\r\n  error(message: string, ...args: any[]): void {\r\n    if (this.shouldLog('error')) {\r\n      console.error(this.formatMessage('error', message), ...args);\r\n    }\r\n  }\r\n}\r\n\r\nexport const logger = new Logger(); ","import { PusherEvent } from \"../types/pusher\";\nimport { logger } from \"@/client/utils/logger\";\nimport { v4 as uuidv4 } from 'uuid';\n\nexport const pusherEvent = async <T>({event, conversationId, data, eventId: providedEventId}: Omit<PusherEvent<T>, 'eventId'> & { eventId?: string }) => {\n    try {\n      const eventId = providedEventId || uuidv4();\n      logger.info(`🔄 Triggering Pusher event [${event}] id [${eventId}] for conversation [${conversationId}]:`, data);\n      \n      const response = await fetch('/api/chat', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          channel: `private-${conversationId}`,\n          event,\n          data: {\n            eventId,\n            createdAt: new Date(),\n            ...data\n          },\n        })\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.details || 'Erreur lors de l\\'envoi de l\\'événement');\n      }\n\n      const result = await response.json();\n      return {\n        eventId,\n        data: result\n      };\n    } catch (error) {\n      console.error('Error in pusherEvent:', error);\n      throw error;\n    }\n};","import type { NextApiRequest, NextApiResponse } from 'next';\r\n\r\nimport { NextRequest } from 'next/server';\r\n\r\nexport class PagesRouterAdapter {\r\n  static convertRequest(req: NextApiRequest): NextRequest {\r\n    const origin = req.headers.origin || 'http://localhost:3000';\r\n    const url = new URL(req.url!, origin);\r\n\r\n    // Créer les headers\r\n    const headers = new Headers();\r\n    Object.entries(req.headers).forEach(([key, value]) => {\r\n      if (value) {\r\n        headers.append(key, Array.isArray(value) ? value.join(', ') : value);\r\n      }\r\n    });\r\n\r\n    // Gérer le body en fonction du Content-Type\r\n    let body: string | undefined;\r\n    const contentType = headers.get('content-type') || '';\r\n    \r\n    if (contentType.includes('application/x-www-form-urlencoded')) {\r\n      // Pour les requêtes form-data, utiliser URLSearchParams\r\n      const formData = new URLSearchParams();\r\n      if (req.body) {\r\n        Object.entries(req.body).forEach(([key, value]) => {\r\n          formData.append(key, String(value));\r\n        });\r\n      }\r\n      body = formData.toString();\r\n    } else if (req.body) {\r\n      // Pour les autres types de requêtes, utiliser JSON\r\n      body = JSON.stringify(req.body);\r\n    }\r\n\r\n    return new NextRequest(url.toString(), {\r\n      method: req.method || 'GET',\r\n      headers,\r\n      body\r\n    });\r\n  }\r\n\r\n  static async convertResponse(response: Response, res: NextApiResponse): Promise<void> {\r\n    // Copier les headers\r\n    response.headers.forEach((value, key) => {\r\n      res.setHeader(key, value);\r\n    });\r\n\r\n    // Définir le status\r\n    res.status(response.status);\r\n\r\n    // Envoyer la réponse\r\n    const data = await response.json();\r\n    res.json(data);\r\n  }\r\n}","\"use client\";\n\nimport { AuthEvent, MessageSeen, SendMessageEvent, TypingEvent } from \"../../types/chat\";\n\nimport { pusherEvent } from \"@/server\";\n\nexport const eventSendMessageEvent = async (conversationId: string, data: Omit<SendMessageEvent, 'createdAt'>) => {\n    const {data: result, eventId} = await pusherEvent<SendMessageEvent>({\n        eventId: data.id,\n        event: 'new-message',\n        conversationId,\n        data: {\n            ...data,\n            createdAt: new Date()\n        }\n    });\n    //On retourne l'eventId pour que le composant Conversation puisse l'utiliser\n    return {\n      eventId,\n      data: result\n    };\n  };\n\nexport const eventTypingEvent = async (conversationId: string, data: TypingEvent) => {  \n    const {data: result, eventId} = await pusherEvent({\n        event: 'user-typing',\n        conversationId,\n        data: data\n    });\n    return {\n        eventId,\n        data: result\n    };\n  }\n\nexport const eventMessageSeenEvent = async (conversationId: string, data: MessageSeen) => {\n    const {data: result, eventId} = await pusherEvent({\n        event: 'message-seen',\n        conversationId,\n        data: data\n    });\n    return {\n        eventId,\n        data: result\n    };\n}\n\nexport const eventAuthEvent = async (conversationId: string, data: AuthEvent) => {  \n    const {data: result, eventId} = await pusherEvent({\n        event: 'auth',\n        conversationId,\n        data: data\n    });\n    return {\n        eventId,\n        data: result\n    };\n}\n","\"use client\";\n\nimport { ReceivedMessageEvent, ReceivedMessageSeenEvent, ReceivedTypingEvent } from '../types/chat';\nimport { useCallback, useEffect, useRef } from 'react';\n\nimport { createChatSubscribes } from '../services/chat/subscribe';\nimport { logger } from '../utils/logger';\nimport { useNextPusherChat } from '../providers/NextPusherChatProvider';\n\ninterface UseChatSubscribeProps {\n  conversationId: string;\n  onMessageReceived?: (message: ReceivedMessageEvent) => void;\n  onMessageSeen?: (messageSeen: ReceivedMessageSeenEvent) => void;\n  onTypingStatus?: (typingStatus: ReceivedTypingEvent) => void;\n  onError?: (error: Error) => void;\n}\n\n// Map pour stocker les souscriptions Pusher par conversation\nexport const pusherSubscriptions = new Map<string, {\n  unsubscribe: () => void;\n  callbacks: Set<UseChatSubscribeProps>;\n}>();\n\n// Fonction pour créer ou récupérer une souscription Pusher\nexport const getOrCreateSubscription = (conversationId: string, pusher: any, userId: string) => {\n  if (!pusherSubscriptions.has(conversationId)) {\n    const events = createChatSubscribes(pusher, userId, {\n      conversationId,\n      onMessageReceived: (message) => {\n        const subscription = pusherSubscriptions.get(conversationId);\n        if (subscription) {\n          subscription.callbacks.forEach((callback) => {\n            callback.onMessageReceived?.(message);\n          });\n        }\n      },\n      onMessageSeen: (messageSeen) => {\n        const subscription = pusherSubscriptions.get(conversationId);\n        if (subscription) {\n          subscription.callbacks.forEach((callback) => {\n            callback.onMessageSeen?.(messageSeen);\n          });\n        }\n      },\n      onTypingStatus: (typingStatus) => {\n        const subscription = pusherSubscriptions.get(conversationId);\n        if (subscription) {\n          subscription.callbacks.forEach((callback) => {\n            callback.onTypingStatus?.(typingStatus);\n          });\n        }\n      },\n      onError: (error) => {\n        const subscription = pusherSubscriptions.get(conversationId);\n        if (subscription) {\n          subscription.callbacks.forEach((callback) => {\n            callback.onError?.(error);\n          });\n        }\n      },\n    });\n\n    const unsubscribe = events.setupConversationSubscribes(conversationId);\n    pusherSubscriptions.set(conversationId, {\n      unsubscribe,\n      callbacks: new Set(),\n    });\n  }\n  return pusherSubscriptions.get(conversationId)!;\n};\n\nexport const useChatSubscribe = ({\n  conversationId,\n  onMessageReceived,\n  onMessageSeen,\n  onTypingStatus,\n  onError,\n}: UseChatSubscribeProps) => {\n  const { pusher, isConnected, userId } = useNextPusherChat();\n  const callbacksRef = useRef<UseChatSubscribeProps>({\n    conversationId,\n    onMessageReceived,\n    onMessageSeen,\n    onTypingStatus,\n    onError,\n  });\n\n  // Mettre à jour les callbacks si nécessaire\n  useEffect(() => {\n    callbacksRef.current = {\n      conversationId,\n      onMessageReceived,\n      onMessageSeen,\n      onTypingStatus,\n      onError,\n    };\n  }, [conversationId, onMessageReceived, onMessageSeen, onTypingStatus, onError]);\n\n  // Gérer l'abonnement/désabonnement\n  useEffect(() => {\n    if (!isConnected || !pusher) return;\n\n    // Obtenir ou créer la souscription\n    const subscription = getOrCreateSubscription(conversationId, pusher, userId);\n    subscription.callbacks.add(callbacksRef.current);\n\n    logger.info(`🔄 [ChatSubscribe] Ajout des callbacks pour la conversation ${conversationId}`);\n\n    // Nettoyage lors du démontage\n    return () => {\n      const subscription = pusherSubscriptions.get(conversationId);\n      if (subscription) {\n        subscription.callbacks.delete(callbacksRef.current);\n        if (subscription.callbacks.size === 0) {\n          subscription.unsubscribe();\n          pusherSubscriptions.delete(conversationId);\n          logger.info(`🔄 [ChatSubscribe] Désabonnement Pusher pour la conversation ${conversationId}`);\n        }\n      }\n      logger.info(`🔄 [ChatSubscribe] Suppression des callbacks pour la conversation ${conversationId}`);\n    };\n  }, [isConnected, conversationId, pusher, userId]);\n\n  return {\n    isConnected,\n  };\n}; ","\"use client\";\n\nimport { ChatEventHandler, ReceivedMessageEvent, ReceivedMessageSeenEvent, ReceivedTypingEvent, TypingEvent } from '../../types/chat';\n\nimport Pusher from 'pusher-js';\nimport { logger } from '@/client/utils/logger';\n\n// Set pour stocker les eventId déjà traités\nconst processedEventIds = new Set<string>();\n\nexport const createChatSubscribes = (\n  pusher: Pusher,\n  userId: string,\n  handlers: ChatEventHandler,\n \n) => {\n  // Set pour stocker les canaux actifs\n  const activeChannels = new Set<string>();\n\n\n\n  const setupConversationSubscribes = (conversationId: string) => {\n    const channelName = `private-${conversationId}`;\n    \n    // Vérifier si le canal est déjà actif\n    if (activeChannels.has(channelName)) {\n      return () => {};\n    }\n\n    const channel = pusher.subscribe(channelName);\n    activeChannels.add(channelName);\n    logger.info(`💬 [Subscribe] Nouveau canal actif: ${channelName}`);\n\n    // Gestion des messages\n    channel.bind('new-message', (props: ReceivedMessageEvent) => {\n      const {eventId, userId: userIdReceived} = props;\n     \n      if (!eventId || processedEventIds.has(eventId) || userIdReceived === userId) {\n        return;\n      }\n      processedEventIds.add(eventId);\n      logger.info(`💬 [Message] Nouveau message`, props);\n      handlers?.onMessageReceived?.(props);\n    });\n\n    // Gestion du statut de frappe autres que l'utilisateur actuel\n    channel.bind('user-typing', (props: ReceivedTypingEvent) => {\n      const {eventId, userId: userIdReceived} = props;\n      if (!eventId || processedEventIds.has(eventId) || userIdReceived === userId || !handlers?.onTypingStatus) {\n        return;\n      }\n      processedEventIds.add(eventId);\n      logger.info(`💬 [Typing] Entrée de frappe`, props);\n      handlers?.onTypingStatus?.(props);\n    });\n\n    // Gestion du statut de lecture\n    channel.bind('message-seen', (props: ReceivedMessageSeenEvent) => {\n      const {eventId, userId: userIdReceived} = props;\n      if (!eventId || processedEventIds.has(eventId) || userIdReceived === userId || !handlers?.onMessageSeen) {\n        return;\n      }\n      processedEventIds.add(eventId);\n      logger.info(`💬 [MessageSeen] Message marqué comme lu`, props);\n      handlers?.onMessageSeen?.(props);\n    });\n\n    return () => {\n      channel.unbind_all();\n      pusher.unsubscribe(channelName);\n      activeChannels.delete(channelName);\n      logger.info(`💬 [Unsubscribe] Canal ${channelName} désactivé`);\n    };\n  };\n\n  return {\n    setupConversationSubscribes,\n  };\n}; ","\"use client\";\n\nimport React, { createContext, useEffect, useState } from \"react\";\n\nimport { Options } from \"pusher-js\";\nimport Pusher from \"pusher-js\";\nimport { createPusherSubscribes } from \"../services/pusher/subscribe\";\nimport { logger } from \"../utils/logger\";\nimport { useContext } from \"react\";\n\ninterface PusherConnectionState {\n  isConnected: boolean;\n  isLoading: boolean;\n  error: string | null;\n  connectionState: string;\n}\n\ninterface PusherContextType extends PusherConnectionState {\n  pusher: Pusher | null;\n  userId: string;\n}\n\nconst PusherContext = createContext<PusherContextType | null>(null);\n\ninterface UseNextPusherChatProps {\n  userId: string;\n  options?: Partial<Options>;\n  children: React.ReactNode;\n}\n\nexport const NextPusherChatProvider: React.FC<UseNextPusherChatProps> = ({\n  userId,\n  options,\n  children,\n}) => {\n  const [connectionState, setConnectionState] = useState<PusherConnectionState>(\n    {\n      isConnected: false,\n      isLoading: true,\n      error: null,\n      connectionState: \"initializing\",\n    }\n  );\n  const [pusher, setPusher] = useState<Pusher | null>(null);\n\n  useEffect(() => {\n    logger.info(\"🚀 Initialisation de Pusher...\");\n    setConnectionState((prev) => ({\n      ...prev,\n      isLoading: true,\n      error: null,\n      connectionState: \"connecting\",\n    }));\n\n    const pusherClient = new Pusher(process.env.NEXT_PUBLIC_PUSHER_KEY || \"\", {\n      cluster: process.env.NEXT_PUBLIC_PUSHER_CLUSTER || \"eu\",\n      authEndpoint: \"/api/chat\",\n      auth: {\n        headers: {\n          \"X-User-Id\": userId,\n        },\n      },\n      ...options,\n    });\n\n    const events = createPusherSubscribes(pusherClient, (newState) => {\n      setConnectionState((prev) => ({\n        ...prev,\n        ...newState,\n      }));\n    });\n\n    events.setupConnectionSubscribes();\n\n    setPusher(pusherClient);\n\n    return () => {\n      logger.info(\"👋 Déconnexion de Pusher...\");\n      pusherClient.disconnect();\n    };\n  }, [userId, options]);\n\n  return (\n    <PusherContext.Provider value={{ ...connectionState, pusher, userId }}>\n      {children}\n    </PusherContext.Provider>\n  );\n};\n\nexport const useNextPusherChat = () => {\n  const context = useContext(PusherContext);\n  if (!context) {\n    throw new Error(\n      \"useNextPusherChat doit être utilisé à l'intérieur d'un NextPusherChatProvider\"\n    );\n  }\n  return context;\n};\n","import Pusher from 'pusher-js';\nimport { logger } from '@/client/utils/logger';\n\ninterface ConnectionState {\n  isConnected: boolean;\n  isLoading: boolean;\n  error: string | null;\n  connectionState: string;\n}\n\n// Fonction pour créer les subscribers Pusher\nexport const createPusherSubscribes = (\n  pusher: Pusher,\n  onConnectionStateChange: (state: Partial<ConnectionState>) => void\n) => {\n  const setupConnectionSubscribes = () => {\n    const connection = pusher.connection;\n\n    connection.bind('connected', () => {\n      logger.info('✅ Pusher connecté avec succès!');\n      onConnectionStateChange({\n        isConnected: true,\n        isLoading: false,\n        error: null,\n        connectionState: 'connected'\n      });\n    });\n\n    connection.bind('connecting', () => {\n      logger.info('🔄 Tentative de connexion à Pusher...');\n      onConnectionStateChange({\n        isLoading: true,\n        connectionState: 'connecting'\n      });\n    });\n\n    connection.bind('disconnected', () => {\n      logger.info('❌ Pusher déconnecté');\n      onConnectionStateChange({\n        isConnected: false,\n        isLoading: false,\n        connectionState: 'disconnected'\n      });\n    });\n\n    connection.bind('error', (err: any) => {\n      console.error('⚠️ Erreur de connexion Pusher:', err);\n      onConnectionStateChange({\n        isConnected: false,\n        isLoading: false,\n        error: err.message || 'Erreur de connexion',\n        connectionState: 'error'\n      });\n    });\n\n    connection.bind('state_change', (states: any) => {\n      logger.info('🔄 Changement d\\'état Pusher:', states);\n    });\n  };\n\n  return {\n    setupConnectionSubscribes,\n  };\n}; ","\"use client\";\n\nimport { ChatEventHandler, Message, SendMessageProps, UseChatProps, User } from '../types/chat';\nimport { eventMessageSeenEvent, eventSendMessageEvent, eventTypingEvent } from '../services/chat/event';\nimport { getOrCreateSubscription, pusherSubscriptions } from './useChatSubscribe';\nimport { useCallback, useEffect, useRef } from 'react';\n\nimport { logger } from '../utils/logger';\nimport { useNextPusherChat } from '../providers/NextPusherChatProvider';\nimport { v4 as uuidv4 } from 'uuid';\n\nexport const useChat = ({onMessageReceived, onTypingStatus, onError, conversationId, participants, onMessageSeen}: UseChatProps) => {\n  const { pusher, isConnected, isLoading, error, connectionState, userId } = useNextPusherChat();\n  const callbacksRef = useRef<UseChatProps>({\n    conversationId,\n    participants,\n    onMessageReceived,\n    onMessageSeen,\n    onTypingStatus,\n    onError,\n  });\n\n  // Mettre à jour les callbacks si nécessaire\n  useEffect(() => {\n    callbacksRef.current = {\n      conversationId,\n      participants,\n      onMessageReceived,\n      onMessageSeen,\n      onTypingStatus,\n      onError,\n    };\n  }, [conversationId, participants, onMessageReceived, onMessageSeen, onTypingStatus, onError]);\n\n  // Gérer l'abonnement/désabonnement\n  useEffect(() => {\n    if (!isConnected || !pusher) return;\n\n    // Obtenir ou créer la souscription\n    const subscription = getOrCreateSubscription(conversationId, pusher, userId);\n    subscription.callbacks.add(callbacksRef.current);\n\n    logger.info(`🔄 [Chat] Ajout des callbacks pour la conversation ${conversationId}`);\n\n    // Nettoyage lors du démontage\n    return () => {\n      const subscription = pusherSubscriptions.get(conversationId);\n      if (subscription) {\n        subscription.callbacks.delete(callbacksRef.current);\n        if (subscription.callbacks.size === 0) {\n          subscription.unsubscribe();\n          pusherSubscriptions.delete(conversationId);\n          logger.info(`🔄 [Chat] Désabonnement Pusher pour la conversation ${conversationId}`);\n        }\n      }\n      logger.info(`🔄 [Chat] Suppression des callbacks pour la conversation ${conversationId}`);\n    };\n  }, [isConnected, conversationId, pusher, userId]);\n\n  // Fonction pour envoyer un message\n  const sendMessage = (message: SendMessageProps | Message) => {\n    return eventSendMessageEvent(conversationId, {\n        userId,\n        content: message.content,\n        attachmentsCount: message.attachments?.length || 0,\n        id: message.id,\n    })\n  };\n\n  // Fonction pour préparer un message sans l'envoyer\n  const prepareMessage = ({content, attachments}: SendMessageProps) => {\n    const eventId = generateUUID();\n    return {\n      eventId,\n      data: {\n        userId,\n        content,\n        attachmentsCount: attachments?.length || 0,\n        createdAt: new Date(),\n      }\n    };\n  };\n\n  // Fonction pour mettre à jour le statut de frappe\n  const updateTypingStatus = (isTyping: boolean) => {\n    return eventTypingEvent(conversationId, {\n        userId,\n        isTyping,\n    })\n  }\n\n  const getParticipant = (id: string): User => {\n    return participants.find((participant) => participant.id === id) || {\n      id: \"unknown\",\n      name: \"Unknown\",\n    };\n  };\n\n  const generateUUID = () => {\n    return uuidv4();\n  }\n\n  // Fonction pour marquer un message comme vu\n  const markMessageAsSeen = (messageId: string) => {\n    return eventMessageSeenEvent(conversationId, {\n      userId,\n      seenAt: new Date()\n    });\n  };\n\n  return {\n    sendMessage,\n    prepareMessage,\n    updateTypingStatus,\n    getParticipant,\n    markMessageAsSeen,\n    connection: {\n      isConnected,\n      isLoading,\n      error,\n      connectionState\n    }\n  };\n}; ","import {\n  ChatConfig,\n  Message,\n  OnMessageSeen,\n  OnSendMessage,\n  ReceiveMessage,\n  SendMessage,\n  SendMessageProps,\n  User,\n} from \"../types/chat\";\nimport React, {\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n} from \"react\";\n\nimport { DEFAULT_CHAT_CONFIG } from \"../constants/constants\";\nimport _ from \"lodash\";\nimport { logger } from \"../utils/logger\";\nimport { mergeConfigWithDefaults } from \"../utils/config\";\nimport { useChat } from \"../hooks/useChat\";\nimport { useNextPusherChat } from \"../providers/NextPusherChatProvider\";\n\ninterface ScrollManager {\n  contentRef: React.RefObject<HTMLDivElement>;\n  scrollToBottom: (behavior?: ScrollBehavior) => void;\n  isAtBottom: boolean;\n}\n\ninterface ChatContextType {\n  messages: Message[];\n  loadingSendMessage: boolean;\n  loadingMore: boolean;\n  hasMore: boolean;\n  typingUsers: string[];\n  participants: User[];\n  config?: ChatConfig;\n  isLoading?: boolean;\n  totalMessages?: number;\n  sendMessage: (props: SendMessageProps) => Promise<void>;\n  loadMoreMessages: () => Promise<void>;\n  updateTypingStatus: (isTyping: boolean) => void;\n  getParticipant: (userId: string) => User;\n  userId: string;\n  scrollManager: ScrollManager;\n  currentMessagesCount: number;\n}\n\nconst ChatContext = createContext<ChatContextType | undefined>(undefined);\n\nexport const useChatContext = () => {\n  const context = useContext(ChatContext);\n  if (!context) {\n    throw new Error(\"useChatContext must be used within a ChatProvider\");\n  }\n  return context;\n};\n\nexport interface ChatProviderProps {\n  conversationId: string;\n  defaultMessages?: Message[];\n  participants: User[];\n  config?: ChatConfig;\n  isLoading?: boolean;\n  totalMessages?: number;\n  onReceiveMessage?: (\n    eventId: string,\n    message: ReceiveMessage\n  ) => Promise<Message>;\n  onSendMessage: (props: OnSendMessage) => Promise<Message>;\n  onMessageSeen?: (props: OnMessageSeen) => void;\n  onLoadMoreMessages: ({\n    oldestMessageId,\n    previousMessages,\n  }: {\n    oldestMessageId: string;\n    previousMessages: Message[];\n  }) => Promise<Message[]>;\n  children: React.ReactNode;\n}\n\nexport const ChatProvider: React.FC<ChatProviderProps> = ({\n  conversationId,\n  defaultMessages,\n  participants,\n  config,\n  isLoading,\n  totalMessages,\n  onReceiveMessage,\n  onSendMessage,\n  onMessageSeen,\n  onLoadMoreMessages,\n  children,\n}) => {\n  const mergedConfig = useMemo(\n    () => mergeConfigWithDefaults(config || DEFAULT_CHAT_CONFIG),\n    [config]\n  );\n  const [messages, setMessages] = React.useState<Message[]>([]);\n  const [loadingSendMessage, setLoadingSendMessage] = React.useState(false);\n  const [loadingMore, setLoadingMore] = React.useState(false);\n  const [hasMore, setHasMore] = React.useState(true);\n  const [typingUsers, setTypingUsers] = React.useState<string[]>([]);\n  const [isAtBottom, setIsAtBottom] = React.useState(true);\n  const { userId } = useNextPusherChat();\n  const contentRef = React.useRef<HTMLDivElement>(null);\n  const [shouldScrollToBottom, setShouldScrollToBottom] = React.useState(false);\n  const SCROLL_THRESHOLD = 10; // pixels de marge pour considérer qu'on est en bas\n  const scrollTimeoutRef = React.useRef<NodeJS.Timeout>();\n\n  const lastMessageSeenRef = useRef<string | null>(null);\n  const isProcessingRef = useRef(false);\n\n  const scrollToBottom = React.useCallback(\n    (behavior: ScrollBehavior = \"smooth\") => {\n      if (contentRef.current) {\n        // Attendre que toutes les images soient chargées\n        const images = contentRef.current.getElementsByTagName(\"img\");\n        const imageLoadPromises = Array.from(images).map((img) => {\n          if (img.complete) return Promise.resolve();\n          return new Promise((resolve) => {\n            img.onload = resolve;\n            img.onerror = resolve; // En cas d'erreur, on continue quand même\n          });\n        });\n\n        Promise.all(imageLoadPromises).then(() => {\n          contentRef.current?.scrollTo({\n            top: contentRef.current.scrollHeight,\n            behavior,\n          });\n        });\n      }\n    },\n    []\n  );\n\n  const handleScroll = React.useCallback(() => {\n    if (!contentRef.current) return;\n\n    // Annuler le timeout précédent s'il existe\n    if (scrollTimeoutRef.current) {\n      clearTimeout(scrollTimeoutRef.current);\n    }\n\n    // Définir un nouveau timeout pour mettre à jour l'état\n    scrollTimeoutRef.current = setTimeout(() => {\n      const { scrollTop, scrollHeight, clientHeight } = contentRef.current!;\n      const isBottom =\n        Math.abs(scrollHeight - scrollTop - clientHeight) < SCROLL_THRESHOLD;\n      setIsAtBottom(isBottom);\n    }, 100); // Délai de 100ms pour réduire les mises à jour\n  }, []);\n\n  React.useEffect(() => {\n    const content = contentRef.current;\n    if (content) {\n      content.addEventListener(\"scroll\", handleScroll);\n      return () => {\n        content.removeEventListener(\"scroll\", handleScroll);\n        if (scrollTimeoutRef.current) {\n          clearTimeout(scrollTimeoutRef.current);\n        }\n      };\n    }\n  }, [handleScroll]);\n\n  React.useEffect(() => {\n    if (shouldScrollToBottom) {\n      // Petit délai pour laisser le temps au message de s'afficher\n      requestAnimationFrame(() => {\n        scrollToBottom();\n      });\n      setShouldScrollToBottom(false);\n    }\n  }, [shouldScrollToBottom, scrollToBottom]);\n\n  //On recupère les messages\n  useEffect(() => {\n    if (messages.length === 0 && defaultMessages) {\n      setMessages(defaultMessages);\n    }\n  }, [defaultMessages]);\n\n  useEffect(() => {\n    logger.info(\"[ChatContext] Liste des messages\", {\n      messages,\n    });\n  }, [messages]);\n\n  const {\n    prepareMessage,\n    sendMessage: sendPusherMessage,\n    updateTypingStatus: updatePusherTypingStatus,\n    getParticipant,\n    markMessageAsSeen,\n  } = useChat({\n    conversationId,\n    participants,\n    onTypingStatus: ({ isTyping, userId }) => {\n      setTypingUsers((prev) =>\n        isTyping ? [...prev, userId] : prev.filter((id) => id !== userId)\n      );\n    },\n    onMessageReceived: (props) => {\n      const { userId: userIdReceived, eventId } = props;\n      if (userIdReceived !== userId) {\n        onReceiveMessage?.(eventId, {\n          ...props,\n          user: getParticipant(userIdReceived),\n          id: eventId,\n        }).then((message) => {\n          setMessages((prev) => {\n            const newMessages = [...prev, message];\n            if (isAtBottom) {\n              setShouldScrollToBottom(true);\n            }\n            return newMessages.slice(\n              -(mergedConfig?.numberOfMessagesToLoad || 30)\n            );\n          });\n        });\n      }\n    },\n    onMessageSeen: (messageSeen) => {\n      const { userId: seenByUserId } = messageSeen;\n      const seenAt = new Date();\n      setMessages((prevMessages) =>\n        prevMessages.map((message) => {\n          // Vérifier si l'utilisateur a déjà vu le message\n          if (message.seenBy?.some((seen) => seen.userId === seenByUserId)) {\n            return message;\n          }\n          return {\n            ...message,\n            seenBy: [\n              ...(message.seenBy || []),\n              {\n                userId: seenByUserId,\n                seenAt,\n              },\n            ],\n          };\n        })\n      );\n    },\n  });\n\n  const sendMessage = useCallback(\n    async (props: SendMessageProps) => {\n      const { content, attachments, createdAt } = props;\n      if (!content.trim() && !attachments?.length) return;\n\n      try {\n        setLoadingSendMessage(true);\n        const { data, eventId } = prepareMessage(props);\n\n        // Envoyer d'abord le message au serveur\n        const updatedMessage = await onSendMessage({\n          conversationId,\n          eventId,\n          message: {\n            id: eventId,\n            ...data,\n            ...props,\n            userId,\n            createdAt,\n          },\n        });\n\n        // Envoyer ensuite le message via Pusher\n        await sendPusherMessage({\n          ...data,\n          ...props,\n          id: eventId,\n          userId,\n          createdAt,\n        });\n\n        setMessages((prev) => {\n          const newMessages = [...prev, updatedMessage];\n          setShouldScrollToBottom(true);\n          return newMessages.slice(\n            -(mergedConfig?.numberOfMessagesToLoad || 30)\n          );\n        });\n      } catch (error) {\n        console.error(\"Erreur lors de l'envoi du message:\", error);\n      } finally {\n        setLoadingSendMessage(false);\n      }\n    },\n    [\n      prepareMessage,\n      sendPusherMessage,\n      onSendMessage,\n      userId,\n      mergedConfig?.numberOfMessagesToLoad,\n    ]\n  );\n\n  const loadMoreMessages = useCallback(async () => {\n    if (!onLoadMoreMessages || loadingMore || !hasMore) {\n      return;\n    }\n\n    const oldestMessage = messages[0];\n    if (!oldestMessage) {\n      setHasMore(false);\n      return;\n    }\n\n    try {\n      setLoadingMore(true);\n      const olderMessages = await onLoadMoreMessages({\n        oldestMessageId: oldestMessage.id,\n        previousMessages: messages,\n      });\n\n      logger.info(\"[ChatContext] On recupère les messages plus anciens\", {\n        olderMessages,\n      });\n\n      if (!olderMessages || olderMessages.length === 0) {\n        setHasMore(false);\n        logger.info(\"[ChatContext] On n'a plus de messages\", {\n          olderMessages,\n        });\n        return;\n      }\n\n      logger.info(\"[ChatContext] On a des messages plus anciens\", {\n        olderMessages,\n        messages,\n      });\n\n      setMessages((prevMessages) => _.concat(olderMessages, prevMessages));\n    } catch (error) {\n      console.error(\n        \"Erreur lors du chargement des messages plus anciens:\",\n        error\n      );\n      setHasMore(false);\n    } finally {\n      setLoadingMore(false);\n    }\n  }, [onLoadMoreMessages, loadingMore, hasMore, messages]);\n\n  const markLastMessageAsSeen = useCallback(\n    (message: Message) => {\n      if (\n        isProcessingRef.current ||\n        lastMessageSeenRef.current === message.id ||\n        message.userId === userId\n      ) {\n        return;\n      }\n\n      if (!_.find(message.seenBy, { userId })) {\n        isProcessingRef.current = true;\n        lastMessageSeenRef.current = message.id;\n        markMessageAsSeen(message.id);\n        onMessageSeen?.({ lastMessage: message, conversationId, userId });\n        isProcessingRef.current = false;\n      }\n    },\n    [userId, conversationId, markMessageAsSeen, onMessageSeen]\n  );\n\n  useEffect(() => {\n    if (!messages.length || !onMessageSeen) {\n      return;\n    }\n\n    const lastMessage = messages[messages.length - 1];\n    markLastMessageAsSeen(lastMessage);\n  }, [messages, markLastMessageAsSeen]);\n\n  const scrollManager: ScrollManager = {\n    contentRef,\n    scrollToBottom,\n    isAtBottom,\n  };\n\n  return (\n    <ChatContext.Provider\n      value={{\n        userId,\n        messages,\n        loadingSendMessage,\n        loadingMore,\n        hasMore,\n        typingUsers,\n        participants,\n        config: mergedConfig,\n        isLoading,\n        totalMessages,\n        sendMessage,\n        loadMoreMessages,\n        updateTypingStatus: updatePusherTypingStatus,\n        getParticipant,\n        scrollManager,\n        currentMessagesCount: messages.length,\n      }}\n    >\n      {children}\n    </ChatContext.Provider>\n  );\n};\n","import { ChatConfig } from \"../types/chat\";\r\n\r\nexport const DEFAULT_CHAT_CONFIG: ChatConfig = {\r\n  activeEmoji: true,\r\n  activeFile: true,\r\n  activeVoice: true,\r\n  activeUserColor: true,\r\n  welcomeMessage: \"Bienvenue dans la conversation\",\r\n  typingTimeout: 10000,\r\n  numberOfMessagesToLoad: 30,\r\n};\r\n","import { ChatConfig } from \"../types/chat\";\r\nimport { DEFAULT_CHAT_CONFIG } from \"../constants/constants\";\r\n\r\nexport const mergeConfigWithDefaults = (config: ChatConfig): ChatConfig => {\r\n  return {\r\n    ...DEFAULT_CHAT_CONFIG,\r\n    ...config,\r\n  };\r\n}; ","import { Box, BoxProps } from \"@mui/material\";\r\n\r\nimport { StyledComponent } from \"@emotion/styled\";\r\nimport { styled } from \"@mui/material/styles\";\r\n\r\nexport const Content: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\r\n  flex: 1,\r\n  padding: theme.spacing(2),\r\n  overflowY: \"auto\",\r\n  backgroundColor: theme.palette.background.paper,\r\n  \"&::-webkit-scrollbar\": {\r\n    width: \"8px\",\r\n  },\r\n  \"&::-webkit-scrollbar-track\": {\r\n    background: theme.palette.background.default,\r\n    borderRadius: \"4px\",\r\n  },\r\n  \"&::-webkit-scrollbar-thumb\": {\r\n    background: theme.palette.primary.main,\r\n    borderRadius: \"4px\",\r\n    \"&:hover\": {\r\n      background: theme.palette.primary.dark,\r\n    },\r\n  },\r\n}));\r\n\r\nexport const WaitingMessageContainer: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\r\n  display: 'flex',\r\n  flexDirection: 'column',\r\n  alignItems: 'center',\r\n  justifyContent: 'center',\r\n  padding: theme.spacing(4),\r\n  textAlign: 'center',\r\n  color: theme.palette.text.secondary,\r\n  gap: theme.spacing(2)\r\n}));\r\n\r\nexport const WaitingMessageEmoji: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\r\n  fontSize: '3rem',\r\n  marginBottom: theme.spacing(2)\r\n}));\r\n\r\nexport const WaitingMessageTitle: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\r\n  fontSize: '1.5rem',\r\n  margin: 0,\r\n  color: theme.palette.text.primary\r\n}));\r\n\r\nexport const WaitingMessageText: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\r\n  fontSize: '1rem',\r\n  maxWidth: '400px',\r\n  lineHeight: 1.5\r\n})); ","import { Box, Button, ButtonProps } from \"@mui/material\";\r\n\r\nimport { StyledComponent } from \"@emotion/styled\";\r\nimport { styled } from \"@mui/material/styles\";\r\n\r\nexport const ActionsContainer: StyledComponent<any> = styled(Box)(({ theme }) => ({\r\n  position: \"relative\",\r\n  display: \"flex\",\r\n  flexDirection: \"column\",\r\n  gap: theme.spacing(1),\r\n  zIndex: 1,\r\n}));\r\n\r\nexport const ScrollButton: StyledComponent<ButtonProps> = styled(Button)(({ theme }) => ({\r\n  position: \"absolute\",\r\n  bottom: theme.spacing(2),\r\n  right: theme.spacing(2),\r\n  backgroundColor: theme.palette.primary.main,\r\n  color: theme.palette.primary.contrastText,\r\n  \"&:hover\": {\r\n    backgroundColor: theme.palette.primary.dark,\r\n  },\r\n  boxShadow: theme.shadows[2],\r\n  width: \"40px\",\r\n  height: \"40px\",\r\n  minWidth: \"40px\",\r\n  padding: 0,\r\n  borderRadius: \"50%\",\r\n  backdropFilter: \"blur(8px)\",\r\n  border: `1px solid ${theme.palette.primary.dark}33`,\r\n  display: \"flex\",\r\n  alignItems: \"center\",\r\n  justifyContent: \"center\",\r\n})); ","import { ActionsContainer, ScrollButton } from \"./style\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nimport { Fade } from \"@mui/material\";\r\nimport KeyboardArrowDownIcon from \"@mui/icons-material/KeyboardArrowDown\";\r\nimport { useChatContext } from \"@/client/contexts/ChatContext\";\r\n\r\nexport const ChatActions = () => {\r\n  const { scrollManager } = useChatContext();\r\n  const { scrollToBottom, isAtBottom } = scrollManager;\r\n  const [showButton, setShowButton] = useState(false);\r\n\r\n  useEffect(() => {\r\n    let timeoutId: NodeJS.Timeout;\r\n\r\n    if (!isAtBottom) {\r\n      // On attend 500ms après la fin du scroll pour afficher le bouton\r\n      timeoutId = setTimeout(() => {\r\n        setShowButton(true);\r\n      }, 500);\r\n    } else {\r\n      // On attend que le défilement soit terminé avant de cacher le bouton\r\n      timeoutId = setTimeout(() => {\r\n        setShowButton(false);\r\n      }, 100);\r\n    }\r\n\r\n    return () => {\r\n      clearTimeout(timeoutId);\r\n    };\r\n  }, [isAtBottom]);\r\n\r\n  return (\r\n    <ActionsContainer>\r\n      <Fade in={showButton}>\r\n        <ScrollButton\r\n          onClick={() => scrollToBottom(\"smooth\")}\r\n          variant=\"contained\"\r\n        >\r\n          <KeyboardArrowDownIcon />\r\n        </ScrollButton>\r\n      </Fade>\r\n    </ActionsContainer>\r\n  );\r\n};\r\n","import { Box, BoxProps, Button, ButtonProps } from \"@mui/material\";\r\n\r\nimport { StyledComponent } from \"@emotion/styled\";\r\nimport { styled } from \"@mui/material/styles\";\r\n\r\nexport const LoadMoreContainer: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\r\n  display: \"flex\",\r\n  justifyContent: \"center\",\r\n  padding: theme.spacing(2),\r\n}));\r\n\r\nexport const LoadMoreButton: StyledComponent<ButtonProps> = styled(Button)(({ theme }) => ({\r\n  borderRadius: \"20px\",\r\n  textTransform: \"none\",\r\n  minWidth: \"150px\",\r\n  maxWidth: \"100%\",\r\n  fontSize: \"0.9rem\",\r\n  padding: \"6px 16px\",\r\n  [theme.breakpoints.up(\"sm\")]: {\r\n    minWidth: \"180px\",\r\n    fontSize: \"0.9rem\",\r\n    padding: \"6px 16px\",\r\n  },\r\n  [theme.breakpoints.down(\"sm\")]: {\r\n    minWidth: \"150px\",\r\n    fontSize: \"0.8rem\",\r\n    padding: \"4px 8px\",\r\n  },\r\n})); ","import { LoadMoreButton, LoadMoreContainer } from \"./style\";\r\n\r\nimport { CircularProgress } from \"@mui/material\";\r\nimport KeyboardArrowUpIcon from \"@mui/icons-material/KeyboardArrowUp\";\r\nimport { useChatContext } from \"@/client/contexts/ChatContext\";\r\nimport { useRef } from \"react\";\r\n\r\nexport const LoadMoreMessages = () => {\r\n  const {\r\n    isLoading,\r\n    loadingMore,\r\n    hasMore,\r\n    totalMessages,\r\n    currentMessagesCount,\r\n    loadMoreMessages,\r\n    scrollManager,\r\n  } = useChatContext();\r\n\r\n  const previousScrollHeight = useRef<number>(0);\r\n  const previousScrollTop = useRef<number>(0);\r\n\r\n  const handleLoadMore = async () => {\r\n    if (scrollManager.contentRef.current) {\r\n      previousScrollHeight.current =\r\n        scrollManager.contentRef.current.scrollHeight;\r\n      previousScrollTop.current = scrollManager.contentRef.current.scrollTop;\r\n    }\r\n    await loadMoreMessages();\r\n    // Restaurer la position du scroll après le chargement\r\n    if (scrollManager.contentRef.current) {\r\n      requestAnimationFrame(() => {\r\n        const newScrollHeight =\r\n          scrollManager.contentRef.current?.scrollHeight || 0;\r\n        const scrollDiff = newScrollHeight - previousScrollHeight.current;\r\n        if (scrollManager.contentRef.current) {\r\n          scrollManager.contentRef.current.scrollTop =\r\n            previousScrollTop.current + scrollDiff;\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  // Masquer le bouton si on a atteint le nombre total de messages\r\n  if (\r\n    !hasMore ||\r\n    isLoading ||\r\n    (totalMessages !== undefined && currentMessagesCount >= totalMessages)\r\n  )\r\n    return null;\r\n\r\n  return (\r\n    <LoadMoreContainer>\r\n      <LoadMoreButton\r\n        variant=\"outlined\"\r\n        onClick={handleLoadMore}\r\n        disabled={loadingMore}\r\n        startIcon={\r\n          loadingMore ? <CircularProgress size={20} /> : <KeyboardArrowUpIcon />\r\n        }\r\n      >\r\n        {loadingMore ? \"Chargement...\" : \"Messages plus anciens\"}\r\n      </LoadMoreButton>\r\n    </LoadMoreContainer>\r\n  );\r\n};\r\n","import { Box, BoxProps, InputBase, InputBaseProps } from \"@mui/material\";\r\n\r\nimport { StyledComponent } from \"@emotion/styled\";\r\nimport { styled } from \"@mui/material/styles\";\r\n\r\nexport const InputContainer: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\r\n  padding: theme.spacing(1),\r\n  borderTop: `1px solid ${theme.palette.divider}`,\r\n  background: theme.palette.background.paper,\r\n  display: \"flex\",\r\n  alignItems: \"center\",\r\n  gap: theme.spacing(0.5),\r\n  [theme.breakpoints.up(\"sm\")]: {\r\n    padding: theme.spacing(1.5),\r\n    gap: theme.spacing(1),\r\n  },\r\n}));\r\n\r\nexport const StyledInput: StyledComponent<InputBaseProps> = styled(InputBase)(({ theme }) => ({\r\n  flex: 1,\r\n  padding: theme.spacing(0.5, 1),\r\n  backgroundColor: theme.palette.background.default,\r\n  borderRadius: 20,\r\n  fontSize: \"0.9rem\",\r\n  \"& input\": {\r\n    padding: theme.spacing(0.5, 0),\r\n  },\r\n  [theme.breakpoints.up(\"sm\")]: {\r\n    padding: theme.spacing(0.5, 1.5),\r\n  },\r\n})); ","import { InputContainer, StyledInput } from \"./style\";\nimport React, { useEffect, useRef, useState } from \"react\";\n\nimport { Box } from \"@mui/material\";\nimport { Button } from \"@mui/material\";\nimport EmojiPickerComponent from \"../EmojiPicker\";\nimport FileList from \"../FileList\";\nimport { FilePicker } from \"../FilePicker\";\nimport SendIcon from \"@mui/icons-material/Send\";\nimport { VoiceRecorder } from \"../VoiceRecorder\";\nimport { useChatContext } from \"@/client/contexts/ChatContext\";\n\nexport default function MessageInput() {\n  const { sendMessage, updateTypingStatus, config, loadingSendMessage } =\n    useChatContext();\n  const inputRef = useRef<HTMLInputElement>(null);\n  // État pour stocker le contenu du message\n  const [message, setMessage] = useState(\"\");\n  // État pour suivre si l'utilisateur est en train de taper\n  const [isTyping, setIsTyping] = useState(false);\n  // Référence pour stocker le timer de désactivation du statut de frappe\n  const typingTimeoutRef = useRef<NodeJS.Timeout>();\n  // Référence pour suivre si le statut de frappe a été explicitement désactivé\n  const isTypingDisabledRef = useRef(false);\n\n  const [selectedFiles, setSelectedFiles] = useState<File[]>([]);\n\n  // Fonction pour nettoyer le timer de frappe\n  const clearTypingTimeout = () => {\n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n    }\n  };\n\n  // Fonction pour gérer l'envoi du message\n  const handleSend = () => {\n    const trimmedMessage = message.trim();\n    if (trimmedMessage.trim() || selectedFiles.length > 0) {\n      clearTypingTimeout();\n      isTypingDisabledRef.current = true;\n      setIsTyping(false);\n      updateTypingStatus(false);\n      sendMessage({\n        content: trimmedMessage,\n        attachments: selectedFiles,\n        createdAt: new Date(),\n      }).finally(() => {\n        setMessage(\"\");\n        setSelectedFiles([]);\n        // Remettre le focus sur l'input après l'envoi\n        setTimeout(() => {\n          inputRef.current?.focus();\n        }, 0);\n      });\n    }\n  };\n\n  // Gestion de l'appui sur les touches (envoi avec Enter)\n  const handleKeyPress = (event: React.KeyboardEvent) => {\n    if (event.key === \"Enter\" && !event.ctrlKey && !event.shiftKey) {\n      event.preventDefault();\n      handleSend();\n    }\n  };\n\n  // Gestion du clic sur un emoji (ajout à la fin du message)\n  const handleEmojiClick = (emoji: string) => {\n    setMessage((prev) => prev + emoji);\n  };\n\n  // Gestion du changement de message\n  const handleMessageChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const newValue = e.target.value;\n    // Capitalisation de la première lettre\n    const capitalizedValue =\n      newValue.charAt(0).toUpperCase() + newValue.slice(1);\n    setMessage(capitalizedValue);\n\n    // Réinitialiser le statut désactivé et réactiver le statut de frappe si nécessaire\n    if (newValue.length > 0) {\n      isTypingDisabledRef.current = false;\n      if (!isTyping) {\n        setIsTyping(true);\n        updateTypingStatus(true);\n      }\n    }\n  };\n\n  // Effet pour synchroniser l'état de frappe avec la longueur du message\n  // et le statut de désactivation\n  useEffect(() => {\n    const newIsTyping = message.length > 0 && !isTypingDisabledRef.current;\n    if (newIsTyping !== isTyping) {\n      setIsTyping(newIsTyping);\n      updateTypingStatus(newIsTyping);\n    }\n  }, [message, isTyping, updateTypingStatus]);\n\n  // Gestion de la perte de focus (sortie du champ)\n  const handleBlur = () => {\n    clearTypingTimeout();\n    // Délai de 10 secondes avant de désactiver le statut de frappe\n    typingTimeoutRef.current = setTimeout(() => {\n      isTypingDisabledRef.current = true;\n      setIsTyping(false);\n      updateTypingStatus(false);\n    }, config?.typingTimeout);\n  };\n\n  // Gestion du focus (entrée dans le champ)\n  const handleFocus = () => {\n    // Si le timer est toujours actif, on ne fait rien\n    if (typingTimeoutRef.current) {\n      return;\n    }\n\n    // Si le timer est terminé, on réinitialise le statut\n    isTypingDisabledRef.current = false;\n    if (message.length > 0) {\n      setIsTyping(true);\n      updateTypingStatus(true);\n    }\n  };\n\n  // Nettoyage du timer lors du démontage du composant\n  useEffect(() => {\n    return () => {\n      clearTypingTimeout();\n    };\n  }, []);\n\n  const handleFilesSelect = (attachments: File[]) => {\n    setSelectedFiles((prev) => [...prev, ...attachments]);\n  };\n\n  const handleRemoveFile = (fileToRemove: File) => {\n    setSelectedFiles((prev) => prev.filter((file) => file !== fileToRemove));\n  };\n\n  const handleVoiceRecording = (audioBlob: Blob) => {\n    const audioFile = new File(\n      [audioBlob],\n      `voice-message-${Date.now()}.webm`,\n      {\n        type: \"audio/webm\",\n      }\n    );\n    setSelectedFiles((prev) => [...prev, audioFile]);\n  };\n\n  return (\n    <Box>\n      <FileList attachments={selectedFiles} onRemoveFile={handleRemoveFile} />\n      <InputContainer>\n        {config?.activeEmoji && (\n          <EmojiPickerComponent\n            onEmojiClick={handleEmojiClick}\n            disabled={loadingSendMessage}\n          />\n        )}\n        {config?.activeFile && (\n          <FilePicker\n            onFilesSelect={handleFilesSelect}\n            disabled={loadingSendMessage}\n          />\n        )}\n        {config?.activeVoice && (\n          <VoiceRecorder\n            onRecordingComplete={handleVoiceRecording}\n            disabled={loadingSendMessage}\n          />\n        )}\n        <StyledInput\n          inputProps={{ ref: inputRef }}\n          disabled={loadingSendMessage}\n          fullWidth\n          placeholder=\"Écrivez un message...\"\n          value={message}\n          onChange={handleMessageChange}\n          onFocus={handleFocus}\n          onBlur={handleBlur}\n          onKeyDown={handleKeyPress}\n          multiline\n          autoFocus\n          maxRows={4}\n        />\n        <Button\n          loading={loadingSendMessage}\n          size=\"small\"\n          onClick={handleSend}\n          color=\"primary\"\n          sx={{\n            minWidth: { xs: \"36px\", sm: \"48px\" },\n            height: { xs: \"36px\", sm: \"48px\" },\n          }}\n        >\n          <SendIcon fontSize=\"small\" />\n        </Button>\n      </InputContainer>\n    </Box>\n  );\n}\n","import { Box, IconButton, Popover } from \"@mui/material\";\r\nimport EmojiPicker, { EmojiClickData } from \"emoji-picker-react\";\r\n\r\nimport SentimentSatisfiedAltIcon from \"@mui/icons-material/SentimentSatisfiedAlt\";\r\nimport { useState } from \"react\";\r\n\r\ninterface EmojiPickerProps {\r\n  onEmojiClick: (emoji: string) => void;\r\n  disabled?: boolean;\r\n}\r\n\r\nconst EmojiPickerComponent: React.FC<EmojiPickerProps> = ({\r\n  onEmojiClick,\r\n  disabled = false,\r\n}) => {\r\n  const [anchorEl, setAnchorEl] = useState<HTMLButtonElement | null>(null);\r\n\r\n  const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\r\n    setAnchorEl(event.currentTarget);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setAnchorEl(null);\r\n  };\r\n\r\n  const handleEmojiClick = (emojiData: EmojiClickData) => {\r\n    onEmojiClick(emojiData.emoji);\r\n    handleClose();\r\n  };\r\n\r\n  const open = Boolean(anchorEl);\r\n\r\n  return (\r\n    <Box>\r\n      <IconButton\r\n        disabled={disabled}\r\n        onClick={handleClick}\r\n        size=\"small\"\r\n        sx={{\r\n          color: \"text.secondary\",\r\n          \"&:hover\": {\r\n            color: \"primary.main\",\r\n          },\r\n        }}\r\n      >\r\n        <SentimentSatisfiedAltIcon />\r\n      </IconButton>\r\n      <Popover\r\n        open={open}\r\n        anchorEl={anchorEl}\r\n        onClose={handleClose}\r\n        anchorOrigin={{\r\n          vertical: \"top\",\r\n          horizontal: \"right\",\r\n        }}\r\n        transformOrigin={{\r\n          vertical: \"bottom\",\r\n          horizontal: \"left\",\r\n        }}\r\n      >\r\n        <EmojiPicker\r\n          onEmojiClick={handleEmojiClick}\r\n          width={300}\r\n          height={400}\r\n          searchPlaceholder=\"Rechercher un emoji...\"\r\n        />\r\n      </Popover>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default EmojiPickerComponent;\r\n","import { Box, Chip } from \"@mui/material\";\n\ninterface FileListProps {\n  attachments: File[];\n  onRemoveFile: (file: File) => void;\n}\n\nconst FileList = ({ attachments, onRemoveFile }: FileListProps) => {\n  if (attachments.length === 0) return null;\n\n  return (\n    <Box\n      sx={{\n        display: \"flex\",\n        flexWrap: \"wrap\",\n        gap: 1,\n        p: 1,\n        borderBottom: \"1px solid\",\n        borderColor: \"divider\",\n      }}\n    >\n      {attachments.map((attachment, index) => (\n        <Chip\n          key={index}\n          label={attachment.name}\n          onDelete={() => onRemoveFile(attachment)}\n          size=\"small\"\n          sx={{\n            maxWidth: 200,\n            position: \"relative\",\n            zIndex: 1,\n            \"&:hover\": {\n              zIndex: 2,\n            },\n            \"& .MuiChip-label\": {\n              overflow: \"hidden\",\n              textOverflow: \"ellipsis\",\n              whiteSpace: \"nowrap\",\n            },\n            \"& .MuiChip-deleteIcon\": {\n              zIndex: 3,\n            },\n          }}\n        />\n      ))}\n    </Box>\n  );\n};\n\nexport default FileList;\n","import { Box, IconButton } from \"@mui/material\";\r\nimport { useRef, useState } from \"react\";\r\n\r\nimport AttachFileIcon from \"@mui/icons-material/AttachFile\";\r\n\r\ninterface FilePickerProps {\r\n  onFilesSelect: (attachments: File[]) => void;\r\n  disabled?: boolean;\r\n}\r\n\r\nexport function FilePicker({\r\n  onFilesSelect,\r\n  disabled = false,\r\n}: FilePickerProps) {\r\n  const [anchorEl, setAnchorEl] = useState<HTMLButtonElement | null>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\r\n    setAnchorEl(event.currentTarget);\r\n    fileInputRef.current?.click();\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setAnchorEl(null);\r\n  };\r\n\r\n  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const attachments = event.target.files;\r\n    if (attachments && attachments.length > 0) {\r\n      onFilesSelect(Array.from(attachments));\r\n    }\r\n    handleClose();\r\n  };\r\n\r\n  const open = Boolean(anchorEl);\r\n\r\n  return (\r\n    <Box>\r\n      <input\r\n        type=\"file\"\r\n        ref={fileInputRef}\r\n        onChange={handleFileChange}\r\n        multiple\r\n        style={{ display: \"none\" }}\r\n      />\r\n      <IconButton\r\n        onClick={handleClick}\r\n        size=\"small\"\r\n        sx={{\r\n          color: \"text.secondary\",\r\n          \"&:hover\": {\r\n            color: \"primary.main\",\r\n          },\r\n        }}\r\n        disabled={disabled}\r\n      >\r\n        <AttachFileIcon />\r\n      </IconButton>\r\n    </Box>\r\n  );\r\n}\r\n","import { Box, CircularProgress, IconButton } from \"@mui/material\";\r\nimport { useRef, useState } from \"react\";\r\n\r\nimport MicIcon from \"@mui/icons-material/Mic\";\r\nimport StopIcon from \"@mui/icons-material/Stop\";\r\n\r\ninterface VoiceRecorderProps {\r\n  onRecordingComplete: (audioBlob: Blob) => void;\r\n  disabled?: boolean;\r\n}\r\n\r\nexport function VoiceRecorder({\r\n  onRecordingComplete,\r\n  disabled = false,\r\n}: VoiceRecorderProps) {\r\n  const [isRecording, setIsRecording] = useState(false);\r\n  const [recordingTime, setRecordingTime] = useState(0);\r\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\r\n  const timerRef = useRef<NodeJS.Timeout>();\r\n  const audioChunksRef = useRef<Blob[]>([]);\r\n\r\n  const startRecording = async () => {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      const mediaRecorder = new MediaRecorder(stream);\r\n      mediaRecorderRef.current = mediaRecorder;\r\n      audioChunksRef.current = [];\r\n\r\n      mediaRecorder.ondataavailable = (event) => {\r\n        if (event.data.size > 0) {\r\n          audioChunksRef.current.push(event.data);\r\n        }\r\n      };\r\n\r\n      mediaRecorder.onstop = () => {\r\n        const audioBlob = new Blob(audioChunksRef.current, {\r\n          type: \"audio/webm\",\r\n        });\r\n        onRecordingComplete(audioBlob);\r\n        stream.getTracks().forEach((track) => track.stop());\r\n        setRecordingTime(0);\r\n      };\r\n\r\n      mediaRecorder.start();\r\n      setIsRecording(true);\r\n\r\n      // Démarrer le timer\r\n      timerRef.current = setInterval(() => {\r\n        setRecordingTime((prev) => prev + 1);\r\n      }, 1000);\r\n    } catch (error) {\r\n      console.error(\"Erreur lors de l'accès au microphone:\", error);\r\n    }\r\n  };\r\n\r\n  const stopRecording = () => {\r\n    if (mediaRecorderRef.current && isRecording) {\r\n      mediaRecorderRef.current.stop();\r\n      setIsRecording(false);\r\n      if (timerRef.current) {\r\n        clearInterval(timerRef.current);\r\n      }\r\n    }\r\n  };\r\n\r\n  const formatTime = (seconds: number) => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = seconds % 60;\r\n    return `${mins}:${secs.toString().padStart(2, \"0\")}`;\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ display: \"flex\", alignItems: \"center\", gap: 1 }}>\r\n      <IconButton\r\n        onClick={isRecording ? stopRecording : startRecording}\r\n        size=\"small\"\r\n        sx={{\r\n          color: isRecording ? \"error.main\" : \"text.secondary\",\r\n          \"&:hover\": {\r\n            color: isRecording ? \"error.dark\" : \"primary.main\",\r\n          },\r\n        }}\r\n        disabled={disabled}\r\n      >\r\n        {isRecording ? <StopIcon /> : <MicIcon />}\r\n      </IconButton>\r\n      {isRecording && (\r\n        <Box sx={{ display: \"flex\", alignItems: \"center\", gap: 1 }}>\r\n          <CircularProgress size={16} color=\"error\" />\r\n          <span style={{ fontSize: \"0.8rem\", color: \"error.main\" }}>\r\n            {formatTime(recordingTime)}\r\n          </span>\r\n        </Box>\r\n      )}\r\n    </Box>\r\n  );\r\n}\r\n","import \"moment/locale/fr\";\n\nimport { Box, CircularProgress, Typography } from \"@mui/material\";\nimport {\n  MessageContainer,\n  MessageContent,\n  MessageGroup,\n  MessageTime,\n  SystemMessage,\n} from \"./styles\";\n\nimport { MessageBubble } from \"../MessageBubble\";\nimport React from \"react\";\nimport { SeenBy } from \"../SeenBy\";\nimport { UserAvatar } from \"../UserAvatar\";\nimport { generateColorFromId } from \"@/client/utils/color\";\nimport moment from \"moment\";\nimport { useChatContext } from \"@/client/contexts/ChatContext\";\n\nmoment.locale(\"fr\");\n\nexport const MessageList = () => {\n  const {\n    messages,\n    participants,\n    getParticipant,\n    isLoading,\n    config,\n    userId,\n    scrollManager,\n  } = useChatContext();\n  const messageEndRef = React.useRef<HTMLDivElement>(null);\n  const containerRef = React.useRef<HTMLDivElement>(null);\n  const [shouldShowContent, setShouldShowContent] = React.useState(false);\n  const isFirstLoadRef = React.useRef(true);\n\n  React.useEffect(() => {\n    if (!isLoading) {\n      setShouldShowContent(true);\n    } else {\n      setShouldShowContent(false);\n    }\n  }, [isLoading]);\n\n  React.useEffect(() => {\n    if (shouldShowContent && isFirstLoadRef.current && messages.length > 0) {\n      const checkAndScroll = () => {\n        if (containerRef.current) {\n          const containerHeight = containerRef.current.scrollHeight;\n          if (containerHeight > 0) {\n            scrollManager.scrollToBottom(\"instant\");\n            isFirstLoadRef.current = false;\n          } else {\n            requestAnimationFrame(checkAndScroll);\n          }\n        }\n      };\n      requestAnimationFrame(checkAndScroll);\n    }\n  }, [shouldShowContent, messages.length, scrollManager]);\n\n  if (isLoading || !shouldShowContent) {\n    return (\n      <Box\n        sx={{\n          display: \"flex\",\n          justifyContent: \"center\",\n          alignItems: \"center\",\n          height: \"100%\",\n          minHeight: \"200px\",\n        }}\n      >\n        <CircularProgress />\n      </Box>\n    );\n  }\n\n  if (!isLoading && messages.length === 0) {\n    return (\n      <MessageContainer ref={containerRef}>\n        <SystemMessage>\n          <Typography\n            variant=\"body2\"\n            color=\"text.secondary\"\n            sx={{\n              fontStyle: \"italic\",\n              opacity: 0.7,\n              fontSize: \"0.85rem\",\n            }}\n          >\n            {config?.welcomeMessage || \"Aucun message pour le moment\"}\n          </Typography>\n        </SystemMessage>\n        <div ref={messageEndRef} />\n      </MessageContainer>\n    );\n  }\n\n  return (\n    <MessageContainer ref={containerRef} className={isLoading ? \"loading\" : \"\"}>\n      {messages.map((message, index) => {\n        const isCurrentUser = message.userId === userId;\n        const userColor =\n          !isCurrentUser && config?.activeUserColor\n            ? generateColorFromId(message.userId)\n            : undefined;\n        const showTime =\n          index === messages.length - 1 ||\n          messages[index + 1]?.userId !== message.userId ||\n          moment(messages[index + 1]?.createdAt).diff(\n            moment(message.createdAt),\n            \"minutes\"\n          ) > 5;\n\n        const hasSpecialContent =\n          message.attachments && message.attachments.length > 0;\n        const hasAudio = message.attachments?.some((attachment) =>\n          attachment.name.match(/\\.(mp3|wav|ogg|m4a)$/i)\n        );\n\n        if (message.type?.toLowerCase() === \"system\") {\n          return (\n            <SystemMessage key={message.id}>\n              <Typography\n                variant=\"body2\"\n                color=\"text.secondary\"\n                sx={{\n                  fontStyle: \"italic\",\n                  opacity: 0.7,\n                  fontSize: \"0.85rem\",\n                }}\n              >\n                {message.content}\n              </Typography>\n            </SystemMessage>\n          );\n        }\n\n        return (\n          <MessageGroup\n            key={message.id}\n            className=\"message-group\"\n            data-message-id={message.id}\n          >\n            <MessageContent>\n              {!isCurrentUser && (\n                <Box sx={{ flexShrink: 0 }}>\n                  <UserAvatar user={getParticipant(message.userId)} />\n                </Box>\n              )}\n              <Box sx={{ display: \"flex\", flexDirection: \"column\", flex: 1 }}>\n                <MessageBubble\n                  isCurrentUser={isCurrentUser}\n                  userColor={userColor}\n                  hasSpecialContent={hasSpecialContent}\n                  hasAudio={hasAudio}\n                  content={message.content}\n                  attachments={message.attachments}\n                />\n                {showTime && (\n                  <MessageTime\n                    variant=\"caption\"\n                    sx={{\n                      alignSelf: isCurrentUser ? \"flex-end\" : \"flex-start\",\n                    }}\n                  >\n                    <span>\n                      {moment(new Date(message.createdAt)).format(\"HH:mm\")}\n                    </span>\n                    {isCurrentUser && (\n                      <SeenBy\n                        message={message}\n                        userId={userId}\n                        getParticipant={getParticipant}\n                        totalParticipants={participants.length}\n                      />\n                    )}\n                  </MessageTime>\n                )}\n              </Box>\n              {isCurrentUser && (\n                <Box sx={{ flexShrink: 0 }}>\n                  <UserAvatar user={getParticipant(message.userId)} />\n                </Box>\n              )}\n            </MessageContent>\n          </MessageGroup>\n        );\n      })}\n      <div ref={messageEndRef} />\n    </MessageContainer>\n  );\n};\n","import { Box, BoxProps, Dialog, DialogProps, Link, LinkProps, Typography, TypographyProps } from \"@mui/material\";\n\nimport { ImgHTMLAttributes } from \"react\";\nimport { StyledComponent } from \"@emotion/styled\";\nimport { styled } from \"@mui/material/styles\";\n\nexport const MessageContainer: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\n  display: \"flex\",\n  flexDirection: \"column\",\n  gap: theme.spacing(1),\n  width: \"100%\",\n  overflowX: \"hidden\",\n  overflowY: \"auto\",\n  \"&.loading\": {\n    overflow: \"hidden\",\n  },\n}));\n\nexport const MessageTime: StyledComponent<TypographyProps> = styled(Typography)(({ theme }) => ({\n  fontSize: \"0.7rem\",\n  color: theme.palette.text.secondary,\n  marginTop: theme.spacing(0.5),\n  display: \"flex\",\n  gap: theme.spacing(1),\n  alignItems: \"center\",\n}));\n\nexport const MessageGroup: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\n  display: \"flex\",\n  flexDirection: \"column\",\n  gap: theme.spacing(0.5),\n  marginBottom: theme.spacing(2),\n  width: \"100%\",\n  overflow: \"hidden\",\n}));\n\nexport const SystemMessage: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\n  display: \"flex\",\n  alignItems: \"center\",\n  justifyContent: \"center\",\n  width: \"100%\",\n  margin: theme.spacing(2, 0),\n  \"&::before, &::after\": {\n    content: '\"\"',\n    flex: 1,\n    height: \"1px\",\n    backgroundColor: theme.palette.divider,\n    margin: theme.spacing(0, 2),\n    opacity: 0.5,\n  },\n}));\n\nexport const MessageContent: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\n  display: \"flex\",\n  gap: theme.spacing(1),\n  alignItems: \"flex-start\",\n  width: \"100%\",\n  overflow: \"hidden\",\n}));\n\nexport const AudioContainer: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\n  display: \"flex\",\n  alignItems: \"center\",\n  gap: theme.spacing(1),\n  padding: theme.spacing(1.5),\n  backgroundColor: theme.palette.background.default,\n  borderRadius: theme.shape.borderRadius,\n  width: \"100%\",\n  overflow: \"hidden\",\n  boxSizing: \"border-box\",\n}));\n\nexport const AudioProgress: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\n  flex: 1,\n  height: 6,\n  backgroundColor: theme.palette.grey[300],\n  borderRadius: 3,\n  position: \"relative\",\n  overflow: \"hidden\",\n  minWidth: 0,\n}));\n\nexport const AudioProgressBar: StyledComponent<BoxProps & { progress: number }> = styled(Box)<{ progress: number }>(\n  ({ theme, progress }) => ({\n    position: \"absolute\",\n    left: 0,\n    top: 0,\n    height: \"100%\",\n    width: `${progress}%`,\n    backgroundColor: theme.palette.primary.main,\n    transition: \"width 0.1s linear\",\n  })\n);\n\nexport const ImageContainer: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\n  position: \"relative\",\n  width: \"100%\",\n  maxHeight: \"300px\",\n  borderRadius: theme.shape.borderRadius,\n  overflow: \"hidden\",\n  cursor: \"pointer\",\n  \"&:hover\": {\n    \"& .image-overlay\": {\n      opacity: 1,\n    },\n  },\n}));\n\nexport const StyledImage: StyledComponent<any> = styled(\"img\")({\n  width: \"100%\",\n  height: \"100%\",\n  objectFit: \"cover\",\n});\n\nexport const ImageOverlay: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\n  position: \"absolute\",\n  top: 0,\n  left: 0,\n  right: 0,\n  bottom: 0,\n  backgroundColor: \"rgba(0, 0, 0, 0.3)\",\n  display: \"flex\",\n  alignItems: \"center\",\n  justifyContent: \"center\",\n  opacity: 0,\n  transition: \"opacity 0.2s ease-in-out\",\n}));\n\nexport const StyledDialog: StyledComponent<DialogProps> = styled(Dialog)(({ theme }) => ({\n  \"& .MuiDialog-paper\": {\n    backgroundColor: \"rgba(0, 0, 0, 0.9)\",\n    maxWidth: \"100vw\",\n    maxHeight: \"100vh\",\n    margin: 0,\n    borderRadius: 0,\n    overflow: \"hidden\",\n  },\n  \"& .MuiDialog-container\": {\n    overflow: \"hidden\",\n  },\n  \"& .MuiBackdrop-root\": {\n    backgroundColor: \"rgba(0, 0, 0, 0.9)\",\n  },\n}));\n\nexport const ViewerImageContainer: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\n  position: \"relative\",\n  width: \"100%\",\n  height: \"100%\",\n  display: \"flex\",\n  alignItems: \"center\",\n  justifyContent: \"center\",\n  padding: theme.spacing(2),\n  overflow: \"hidden\",\n}));\n\nexport const ViewerImage: StyledComponent<ImgHTMLAttributes<HTMLImageElement> & { scale: number }> = styled(\"img\")<{ scale: number }>(\n  ({ scale }) => ({\n    maxWidth: \"100%\",\n    maxHeight: \"100%\",\n    objectFit: \"contain\",\n    transform: `scale(${scale})`,\n    transition: \"transform 0.2s ease-in-out\",\n  })\n);\n\nexport const ControlsContainer: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\n  position: \"absolute\",\n  top: theme.spacing(2),\n  left: \"50%\",\n  transform: \"translateX(-50%)\",\n  display: \"flex\",\n  gap: theme.spacing(1),\n  zIndex: 1,\n  backgroundColor: \"rgba(0, 0, 0, 0.5)\",\n  padding: theme.spacing(1),\n  borderRadius: theme.shape.borderRadius,\n}));\n\nexport const FileContainer: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\n  display: \"flex\",\n  flexDirection: \"column\",\n  gap: theme.spacing(1),\n  marginTop: theme.spacing(1),\n  padding: theme.spacing(1),\n  backgroundColor: theme.palette.background.default,\n  borderRadius: theme.shape.borderRadius,\n  border: `1px solid ${theme.palette.divider}`,\n}));\n\nexport const FileLink: StyledComponent<LinkProps> = styled(Link)(({ theme }) => ({\n  display: \"flex\",\n  alignItems: \"center\",\n  gap: theme.spacing(1),\n  color: theme.palette.text.primary,\n  textDecoration: \"none\",\n  padding: theme.spacing(1),\n  borderRadius: theme.shape.borderRadius,\n  transition: \"all 0.2s ease-in-out\",\n  \"&:hover\": {\n    backgroundColor: theme.palette.action.hover,\n    textDecoration: \"none\",\n  },\n}));\n\nexport const FileName: StyledComponent<TypographyProps> = styled(Typography)(({ theme }) => ({\n  fontSize: \"0.85rem\",\n  fontWeight: 500,\n  overflow: \"hidden\",\n  textOverflow: \"ellipsis\",\n  whiteSpace: \"nowrap\",\n  maxWidth: \"200px\",\n}));\n\nexport const IconWrapper: StyledComponent<any> = styled(\"div\")(({ theme }) => ({\n  display: \"flex\",\n  alignItems: \"center\",\n  justifyContent: \"center\",\n  width: \"24px\",\n  height: \"24px\",\n})); ","import { Box, Link, Typography } from \"@mui/material\";\r\nimport { LinkContainer, StyledMessageBubble } from \"./style\";\r\n\r\nimport { Attachment } from \"@/client/types/chat\";\r\nimport LinkIcon from \"@mui/icons-material/Link\";\r\nimport { MessageFiles } from \"../MessageList/MessageFiles\";\r\nimport React from \"react\";\r\n\r\ninterface MessageBubbleProps {\r\n  isCurrentUser: boolean;\r\n  userColor?: string;\r\n  hasSpecialContent?: boolean;\r\n  hasAudio?: boolean;\r\n  content: string;\r\n  attachments?: Attachment[];\r\n  onImageLoad?: () => void;\r\n}\r\n\r\nconst detectUrls = (text: string, isCurrentUser: boolean) => {\r\n  const urlRegex = /(https?:\\/\\/[^\\s]+)/g;\r\n  const parts = text.split(urlRegex);\r\n  const matches = Array.from(text.matchAll(urlRegex)).map((match) => match[0]);\r\n\r\n  return parts.map((part, index) => {\r\n    if (matches.includes(part)) {\r\n      return (\r\n        <LinkContainer key={index}>\r\n          <Link\r\n            href={part}\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n            underline=\"hover\"\r\n            sx={{\r\n              color: isCurrentUser ? \"inherit\" : \"primary.main\",\r\n              \"&:hover\": {\r\n                color: isCurrentUser ? \"inherit\" : \"primary.dark\",\r\n              },\r\n            }}\r\n          >\r\n            {part}\r\n          </Link>\r\n          <LinkIcon\r\n            onClick={() => window.open(part, \"_blank\", \"noopener,noreferrer\")}\r\n            sx={{\r\n              color: isCurrentUser ? \"inherit\" : \"primary.main\",\r\n              opacity: 0.8,\r\n              \"&:hover\": {\r\n                opacity: 1,\r\n              },\r\n            }}\r\n          />\r\n        </LinkContainer>\r\n      );\r\n    }\r\n    return <React.Fragment key={index}>{part}</React.Fragment>;\r\n  });\r\n};\r\n\r\nexport const MessageBubble: React.FC<MessageBubbleProps> = ({\r\n  isCurrentUser,\r\n  userColor,\r\n  hasSpecialContent,\r\n  hasAudio,\r\n  content,\r\n  attachments,\r\n  onImageLoad,\r\n}) => {\r\n  return (\r\n    <StyledMessageBubble\r\n      isCurrentUser={isCurrentUser}\r\n      userColor={userColor}\r\n      hasSpecialContent={hasSpecialContent}\r\n      hasAudio={hasAudio}\r\n    >\r\n      <Box component=\"div\">\r\n        <Typography\r\n          component=\"span\"\r\n          variant=\"body1\"\r\n          sx={{ whiteSpace: \"pre-wrap\" }}\r\n        >\r\n          {detectUrls(content, isCurrentUser)}\r\n        </Typography>\r\n        {attachments && (\r\n          <MessageFiles attachments={attachments} onImageLoad={onImageLoad} />\r\n        )}\r\n      </Box>\r\n    </StyledMessageBubble>\r\n  );\r\n};\r\n","import { Box, BoxProps, Link, Typography } from \"@mui/material\";\r\n\r\nimport { StyledComponent } from \"@emotion/styled\";\r\nimport { styled } from \"@mui/material/styles\";\r\n\r\nexport const StyledMessageBubble: StyledComponent<BoxProps & {\r\n  isCurrentUser: boolean;\r\n  userColor?: string;\r\n  hasSpecialContent?: boolean;\r\n  hasAudio?: boolean;\r\n}> = styled(Box, {\r\n  shouldForwardProp: (prop) =>\r\n    prop !== \"isCurrentUser\" &&\r\n    prop !== \"userColor\" &&\r\n    prop !== \"hasSpecialContent\" &&\r\n    prop !== \"hasAudio\",\r\n})<{\r\n  isCurrentUser: boolean;\r\n  userColor?: string;\r\n  hasSpecialContent?: boolean;\r\n  hasAudio?: boolean;\r\n}>(\r\n  ({\r\n    theme,\r\n    isCurrentUser,\r\n    userColor,\r\n    hasSpecialContent = false,\r\n    hasAudio = false,\r\n  }) => ({\r\n    position: \"relative\",\r\n    padding: theme.spacing(1.5, 2),\r\n    borderRadius: isCurrentUser\r\n      ? `${theme.spacing(2)} 0 ${theme.spacing(2)} ${theme.spacing(2)}`\r\n      : `0 ${theme.spacing(2)} ${theme.spacing(2)} ${theme.spacing(2)}`,\r\n    width: hasAudio ? \"calc(100% - 48px)\" : \"fit-content\",\r\n    maxWidth: hasAudio ? \"calc(100% - 48px)\" : \"70%\",\r\n    wordBreak: \"break-word\",\r\n    marginBottom: theme.spacing(1),\r\n    alignSelf: isCurrentUser ? \"flex-end\" : \"flex-start\",\r\n    backgroundColor: isCurrentUser\r\n      ? theme.palette.primary.main\r\n      : userColor || theme.palette.grey[100],\r\n    color: isCurrentUser ? theme.palette.primary.contrastText : \"inherit\",\r\n    textAlign: \"left\",\r\n    \"&::after\": {\r\n      content: '\"\"',\r\n      position: \"absolute\",\r\n      bottom: 0,\r\n      width: 0,\r\n      height: 0,\r\n      border: \"6px solid transparent\",\r\n      borderBottom: 0,\r\n      [isCurrentUser ? \"right\" : \"left\"]: 12,\r\n      borderTopColor: isCurrentUser\r\n        ? theme.palette.primary.main\r\n        : userColor || theme.palette.grey[100],\r\n    },\r\n    [theme.breakpoints.up(\"sm\")]: {\r\n      width: hasAudio ? \"70%\" : \"fit-content\",\r\n      maxWidth: \"70%\",\r\n    },\r\n  })\r\n);\r\n\r\nexport const LinkContainer: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\r\n  display: \"inline-flex\",\r\n  alignItems: \"center\",\r\n  gap: theme.spacing(0.5),\r\n  \"& .MuiSvgIcon-root\": {\r\n    fontSize: \"0.9em\",\r\n    cursor: \"pointer\",\r\n  },\r\n})); ","export const isImage = (fileName: string): boolean => {\r\n  const imageExtensions = [\".jpg\", \".jpeg\", \".png\", \".gif\", \".webp\"];\r\n  return imageExtensions.some((ext) => fileName.toLowerCase().endsWith(ext));\r\n};\r\n\r\nexport const isAudio = (fileName: string): boolean => {\r\n  const audioExtensions = [\".mp3\", \".wav\", \".ogg\", \".webm\"];\r\n  return audioExtensions.some((ext) => fileName.toLowerCase().endsWith(ext));\r\n};\r\n\r\nexport const isPdf = (fileName: string): boolean => {\r\n  return fileName.toLowerCase().endsWith(\".pdf\");\r\n};\r\n\r\nexport const isDocument = (fileName: string): boolean => {\r\n  const documentExtensions = [\".doc\", \".docx\", \".txt\", \".rtf\"];\r\n  return documentExtensions.some((ext) => fileName.toLowerCase().endsWith(ext));\r\n}; ","import { AudioContainer, AudioProgress, AudioProgressBar } from \"./styles\";\nimport { Box, IconButton, Typography } from \"@mui/material\";\nimport { useRef, useState } from \"react\";\n\nimport PauseIcon from \"@mui/icons-material/Pause\";\nimport PlayArrowIcon from \"@mui/icons-material/PlayArrow\";\n\nconst formatTime = (seconds: number) => {\n  if (!isFinite(seconds) || isNaN(seconds)) {\n    return \"0:00\";\n  }\n  const mins = Math.floor(seconds / 60);\n  const secs = Math.floor(seconds % 60);\n  return `${mins}:${secs.toString().padStart(2, \"0\")}`;\n};\n\ninterface AudioMessageProps {\n  url: string;\n}\n\nexport const AudioMessage: React.FC<AudioMessageProps> = ({ url }) => {\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const audioRef = useRef<HTMLAudioElement | null>(null);\n\n  const handlePlayPause = () => {\n    if (!audioRef.current) {\n      audioRef.current = new Audio(url);\n\n      audioRef.current.addEventListener(\"error\", (e) => {\n        console.error(\"Erreur de chargement audio:\", e);\n      });\n\n      audioRef.current.addEventListener(\"durationchange\", () => {\n        if (\n          audioRef.current &&\n          isFinite(audioRef.current.duration) &&\n          audioRef.current.duration > 0\n        ) {\n          setDuration(audioRef.current.duration);\n        }\n      });\n\n      audioRef.current.addEventListener(\"progress\", () => {\n        if (\n          audioRef.current &&\n          isFinite(audioRef.current.duration) &&\n          audioRef.current.duration > 0\n        ) {\n          setDuration(audioRef.current.duration);\n        }\n      });\n\n      audioRef.current.load();\n\n      audioRef.current.addEventListener(\"timeupdate\", () => {\n        if (audioRef.current) {\n          setCurrentTime(audioRef.current.currentTime);\n        }\n      });\n\n      audioRef.current.addEventListener(\"ended\", () => {\n        setIsPlaying(false);\n        setCurrentTime(0);\n      });\n    }\n\n    if (isPlaying) {\n      audioRef.current?.pause();\n    } else {\n      audioRef.current?.play();\n    }\n    setIsPlaying(!isPlaying);\n  };\n\n  const progress = duration > 0 ? (currentTime / duration) * 100 : 0;\n\n  return (\n    <AudioContainer>\n      <IconButton\n        size=\"medium\"\n        onClick={handlePlayPause}\n        sx={{\n          color: \"primary.main\",\n          \"&:hover\": {\n            backgroundColor: \"action.hover\",\n          },\n          flexShrink: 0,\n          width: { xs: 36, sm: 40 },\n          height: { xs: 36, sm: 40 },\n        }}\n      >\n        {isPlaying ? <PauseIcon /> : <PlayArrowIcon />}\n      </IconButton>\n      <Box sx={{ flex: 1, minWidth: 0, pr: 1, overflow: \"hidden\" }}>\n        <AudioProgress>\n          <AudioProgressBar progress={progress} />\n        </AudioProgress>\n        <Box\n          sx={{\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            mt: 1,\n            width: \"100%\",\n            gap: 1,\n          }}\n        >\n          <Typography\n            variant=\"caption\"\n            color=\"text.secondary\"\n            sx={{\n              fontSize: { xs: \"0.7rem\", sm: \"0.8rem\" },\n              minWidth: { xs: \"30px\", sm: \"40px\" },\n            }}\n          >\n            {formatTime(currentTime)}\n          </Typography>\n          <Typography\n            variant=\"caption\"\n            color=\"text.secondary\"\n            sx={{\n              fontSize: { xs: \"0.7rem\", sm: \"0.8rem\" },\n              minWidth: { xs: \"30px\", sm: \"40px\" },\n              textAlign: \"right\",\n            }}\n          >\n            {formatTime(duration)}\n          </Typography>\n        </Box>\n      </Box>\n    </AudioContainer>\n  );\n};\n","import { Box, Typography } from \"@mui/material\";\r\nimport { ImageContainer, ImageOverlay, StyledImage } from \"./styles\";\r\n\r\nimport { ImageViewer } from \"./ImageViewer\";\r\nimport React from \"react\";\r\n\r\ninterface ImageFileProps {\r\n  url: string;\r\n  name: string;\r\n  onLoad?: () => void;\r\n}\r\n\r\nexport const ImageFile: React.FC<ImageFileProps> = ({ url, name, onLoad }) => {\r\n  const [isViewerOpen, setIsViewerOpen] = React.useState(false);\r\n\r\n  const handleClick = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    setIsViewerOpen(true);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <ImageContainer onClick={handleClick}>\r\n        <StyledImage src={url} alt={name} onLoad={onLoad} />\r\n        <ImageOverlay className=\"image-overlay\">\r\n          <Typography variant=\"body2\" color=\"white\">\r\n            Cliquez pour agrandir\r\n          </Typography>\r\n        </ImageOverlay>\r\n      </ImageContainer>\r\n      <ImageViewer\r\n        open={isViewerOpen}\r\n        onClose={() => setIsViewerOpen(false)}\r\n        imageUrl={url}\r\n        imageName={name}\r\n      />\r\n    </>\r\n  );\r\n};\r\n","import { Box, IconButton, Tooltip } from \"@mui/material\";\r\nimport {\r\n  ControlsContainer,\r\n  StyledDialog,\r\n  ViewerImage,\r\n  ViewerImageContainer,\r\n} from \"./styles\";\r\n\r\nimport CloseIcon from \"@mui/icons-material/Close\";\r\nimport DownloadIcon from \"@mui/icons-material/Download\";\r\nimport React from \"react\";\r\nimport ZoomInIcon from \"@mui/icons-material/ZoomIn\";\r\nimport ZoomOutIcon from \"@mui/icons-material/ZoomOut\";\r\n\r\ninterface ImageViewerProps {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  imageUrl: string;\r\n  imageName: string;\r\n}\r\n\r\nexport const ImageViewer: React.FC<ImageViewerProps> = ({\r\n  open,\r\n  onClose,\r\n  imageUrl,\r\n  imageName,\r\n}) => {\r\n  const [scale, setScale] = React.useState(1);\r\n\r\n  const handleZoomIn = () => {\r\n    setScale((prev) => Math.min(prev + 0.25, 3));\r\n  };\r\n\r\n  const handleZoomOut = () => {\r\n    setScale((prev) => Math.max(prev - 0.25, 0.5));\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setScale(1);\r\n    onClose();\r\n  };\r\n\r\n  const handleDownload = () => {\r\n    const link = document.createElement(\"a\");\r\n    link.href = imageUrl;\r\n    link.download = imageName;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n  };\r\n\r\n  return (\r\n    <StyledDialog\r\n      open={open}\r\n      onClose={handleClose}\r\n      fullScreen\r\n      onClick={handleClose}\r\n      disableEnforceFocus\r\n      disableAutoFocus\r\n    >\r\n      <ViewerImageContainer onClick={(e) => e.stopPropagation()}>\r\n        <ControlsContainer>\r\n          <Tooltip title=\"Zoom avant\">\r\n            <IconButton onClick={handleZoomIn} sx={{ color: \"white\" }}>\r\n              <ZoomInIcon />\r\n            </IconButton>\r\n          </Tooltip>\r\n          <Tooltip title=\"Zoom arrière\">\r\n            <IconButton onClick={handleZoomOut} sx={{ color: \"white\" }}>\r\n              <ZoomOutIcon />\r\n            </IconButton>\r\n          </Tooltip>\r\n          <Tooltip title=\"Télécharger\">\r\n            <IconButton onClick={handleDownload} sx={{ color: \"white\" }}>\r\n              <DownloadIcon />\r\n            </IconButton>\r\n          </Tooltip>\r\n          <Tooltip title=\"Fermer\">\r\n            <IconButton onClick={handleClose} sx={{ color: \"white\" }}>\r\n              <CloseIcon />\r\n            </IconButton>\r\n          </Tooltip>\r\n        </ControlsContainer>\r\n        <ViewerImage\r\n          src={imageUrl}\r\n          alt={imageName}\r\n          scale={scale}\r\n          onClick={(e) => e.stopPropagation()}\r\n        />\r\n      </ViewerImageContainer>\r\n    </StyledDialog>\r\n  );\r\n};\r\n","import { Box, Link, Typography } from \"@mui/material\";\r\nimport { FileContainer, FileLink, FileName, IconWrapper } from \"./styles\";\r\n\r\nimport { Attachment } from \"@/client/types/chat\";\r\nimport InsertDriveFileIcon from \"@mui/icons-material/InsertDriveFile\";\r\nimport React from \"react\";\r\n\r\ntype RegularFileProps = Pick<Attachment, \"name\" | \"url\">;\r\n\r\nexport const RegularFile: React.FC<RegularFileProps> = ({ name, url }) => {\r\n  return (\r\n    <FileContainer>\r\n      <IconWrapper>\r\n        <InsertDriveFileIcon />\r\n      </IconWrapper>\r\n      <Box sx={{ flex: 1, minWidth: 0 }}>\r\n        <FileLink href={url} target=\"_blank\" rel=\"noopener noreferrer\">\r\n          <FileName variant=\"body2\" noWrap>\r\n            {name}\r\n          </FileName>\r\n        </FileLink>\r\n      </Box>\r\n    </FileContainer>\r\n  );\r\n};\r\n","import { isAudio, isImage } from \"../../../../utils/fileUtils\";\r\n\r\nimport { Attachment } from \"../../../../types/chat\";\r\nimport { AudioMessage } from \"./AudioMessage\";\r\nimport { FileContainer } from \"./styles\";\r\nimport { ImageFile } from \"./ImageFile\";\r\nimport { RegularFile } from \"./RegularFile\";\r\n\r\ninterface MessageFilesProps {\r\n  attachments: Attachment[];\r\n  onImageLoad?: () => void;\r\n}\r\n\r\nexport const MessageFiles: React.FC<MessageFilesProps> = ({\r\n  attachments,\r\n  onImageLoad,\r\n}) => {\r\n  if (!attachments || attachments.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <FileContainer>\r\n      {attachments.map((attachment, index) => {\r\n        if (isImage(attachment.name)) {\r\n          return (\r\n            <ImageFile\r\n              key={index}\r\n              url={attachment.url}\r\n              name={attachment.name}\r\n              onLoad={onImageLoad}\r\n            />\r\n          );\r\n        } else if (isAudio(attachment.name)) {\r\n          return <AudioMessage key={index} url={attachment.url} />;\r\n        } else {\r\n          return (\r\n            <RegularFile\r\n              key={index}\r\n              url={attachment.url}\r\n              name={attachment.name}\r\n            />\r\n          );\r\n        }\r\n      })}\r\n    </FileContainer>\r\n  );\r\n};\r\n","import { Box, Tooltip, Typography } from \"@mui/material\";\nimport { Message, User } from \"../../../../types/chat\";\n\nimport CheckCircleIcon from \"@mui/icons-material/CheckCircle\";\nimport CheckCircleOutlineIcon from \"@mui/icons-material/CheckCircleOutline\";\nimport React from \"react\";\nimport { SeenContainer } from \"./style\";\nimport moment from \"moment\";\n\ninterface SeenByProps {\n  message: Message;\n  userId: string;\n  getParticipant: (id: string) => User;\n  totalParticipants: number;\n}\n\nexport const SeenBy: React.FC<SeenByProps> = ({\n  message,\n  userId,\n  getParticipant,\n  totalParticipants,\n}) => {\n  if (!message.seenBy?.length) return null;\n\n  const seenParticipants = message.seenBy\n    .filter((seen) => seen.userId !== userId)\n    .map((seen) => ({\n      ...getParticipant(seen.userId),\n      seenAt: seen.seenAt,\n    }));\n\n  if (seenParticipants.length === 0) return null;\n\n  const allParticipantsHaveSeen =\n    seenParticipants.length === totalParticipants - 1; // -1 pour exclure l'expéditeur\n\n  const tooltipContent = (\n    <Box>\n      {seenParticipants.map((participant) => (\n        <Typography\n          key={participant.id}\n          variant=\"caption\"\n          sx={{ display: \"block\" }}\n        >\n          {participant.name} - {moment(participant.seenAt).format(\"HH:mm\")}\n        </Typography>\n      ))}\n    </Box>\n  );\n\n  return (\n    <SeenContainer>\n      <Tooltip title={tooltipContent}>\n        {allParticipantsHaveSeen ? (\n          <CheckCircleIcon />\n        ) : (\n          <CheckCircleOutlineIcon />\n        )}\n      </Tooltip>\n    </SeenContainer>\n  );\n};\n","import { Box, BoxProps } from \"@mui/material\";\r\n\r\nimport { StyledComponent } from \"@emotion/styled\";\r\nimport { styled } from \"@mui/material/styles\";\r\n\r\nexport const SeenContainer: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\r\n  display: \"flex\",\r\n  alignItems: \"center\",\r\n  gap: theme.spacing(0.5),\r\n  \"& .MuiSvgIcon-root\": {\r\n    fontSize: \"1rem\",\r\n    color: theme.palette.text.secondary,\r\n  },\r\n})); ","import { Avatar, Tooltip } from \"@mui/material\";\r\n\r\nimport React from \"react\";\r\nimport { User } from \"../../../../types/chat\";\r\n\r\ninterface UserAvatarProps {\r\n  user: User;\r\n  size?: number;\r\n}\r\n\r\nexport const UserAvatar = React.forwardRef<HTMLDivElement, UserAvatarProps>(\r\n  ({ user, size = 32 }, ref) => {\r\n    const getInitials = (name: string) => {\r\n      return name\r\n        .split(\" \")\r\n        .map((n) => n[0])\r\n        .join(\"\")\r\n        .toUpperCase()\r\n        .slice(0, 2);\r\n    };\r\n\r\n    return (\r\n      <Tooltip title={user.name} arrow placement=\"top\">\r\n        <Avatar\r\n          ref={ref}\r\n          src={user.avatar}\r\n          alt={user.name}\r\n          sx={{\r\n            width: size,\r\n            height: size,\r\n            bgcolor: \"grey.300\",\r\n            fontSize: `${size * 0.4}px`,\r\n            cursor: \"pointer\",\r\n          }}\r\n        >\r\n          {!user.avatar && getInitials(user.name)}\r\n        </Avatar>\r\n      </Tooltip>\r\n    );\r\n  }\r\n);\r\n\r\nUserAvatar.displayName = \"UserAvatar\";\r\n","export const generateColorFromId = (id: string): string => {\r\n  const hash = id.split(\"\").reduce((acc, char) => {\r\n    const charCode = char.charCodeAt(0);\r\n    return (acc << 5) - acc + charCode;\r\n  }, 0);\r\n  const goldenRatio = 0.618033988749895;\r\n  const hue = (hash * goldenRatio) % 360;\r\n  return `hsl(${hue}, 85%, 75%)`;\r\n}; ","import { Collapse, Typography } from \"@mui/material\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\nimport { Container } from \"./styles\";\r\nimport { User } from \"../../../../types/chat\";\r\nimport { useChatContext } from \"@/client/contexts/ChatContext\";\r\n\r\nexport const TypingIndicator = () => {\r\n  const { typingUsers, participants, userId } = useChatContext();\r\n  const [isVisible, setIsVisible] = useState(false);\r\n\r\n  //On supprime l'utilisateur actif du tableau\r\n  const typingUsersWithoutCurrentUser = typingUsers.filter(\r\n    (user: string) => user !== userId\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (typingUsersWithoutCurrentUser.length > 0) {\r\n      setIsVisible(true);\r\n    } else {\r\n      const timer = setTimeout(() => {\r\n        setIsVisible(false);\r\n      }, 1000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [typingUsersWithoutCurrentUser]);\r\n\r\n  const getTypingUsersNames = () => {\r\n    if (!typingUsersWithoutCurrentUser.length) return \"\";\r\n\r\n    const typingParticipants = participants.filter(\r\n      (user: User) =>\r\n        typingUsersWithoutCurrentUser.includes(user.id) && user.id !== userId\r\n    );\r\n\r\n    if (typingParticipants.length === 0) return \"\";\r\n\r\n    const names = typingParticipants.map((user: User) => user.name);\r\n    if (names.length === 1) {\r\n      return `${names[0]} écrit...`;\r\n    } else if (names.length === 2) {\r\n      return `${names[0]} et ${names[1]} écrivent...`;\r\n    } else {\r\n      return `${names[0]}, ${names[1]} et ${\r\n        names.length - 2\r\n      } autre(s) écrivent...`;\r\n    }\r\n  };\r\n\r\n  const typingText = getTypingUsersNames();\r\n\r\n  return (\r\n    <Collapse in={isVisible} sx={{ pl: 2 }}>\r\n      <Container>\r\n        <Typography\r\n          variant=\"caption\"\r\n          color=\"text.secondary\"\r\n          sx={{\r\n            fontStyle: \"italic\",\r\n            fontSize: \"0.75rem\",\r\n            opacity: typingText ? 1 : 0,\r\n            transition: \"opacity 0.3s ease-in-out\",\r\n          }}\r\n        >\r\n          {typingText}\r\n        </Typography>\r\n      </Container>\r\n    </Collapse>\r\n  );\r\n};\r\n","import { Box } from \"@mui/material\";\r\nimport { StyledComponent } from \"@emotion/styled\";\r\nimport { styled } from \"@mui/material/styles\";\r\n\r\nexport const Container: StyledComponent<any> = styled(Box)(({ theme }) => ({\r\n  padding: theme.spacing(0.5),\r\n  marginTop: theme.spacing(0.5),\r\n  marginBottom: theme.spacing(0.5),\r\n  height: \"24px\",\r\n  display: \"flex\",\r\n  alignItems: \"center\",\r\n})); ","import { ChatProvider, useChatContext } from \"@/client/contexts/ChatContext\";\nimport {\n  Content,\n  WaitingMessageContainer,\n  WaitingMessageEmoji,\n  WaitingMessageText,\n  WaitingMessageTitle,\n} from \"./style\";\nimport React, { useEffect, useRef, useState } from \"react\";\n\nimport { ChatActions } from \"./components/ChatActions\";\nimport { ChatProps } from \"../../types/chat\";\nimport { LoadMoreMessages } from \"./components/LoadMoreMessages\";\nimport MessageInput from \"./components/MessageInput\";\nimport { MessageList } from \"./components/MessageList\";\nimport { TypingIndicator } from \"./components/TypingIndicator\";\n\nconst ChatConversationContent: React.FC = () => {\n  const { scrollManager } = useChatContext();\n  const { contentRef } = scrollManager;\n\n  return (\n    <>\n      <Content ref={contentRef}>\n        <LoadMoreMessages />\n\n        <MessageList />\n      </Content>\n      <ChatActions />\n      <TypingIndicator />\n      <MessageInput />\n    </>\n  );\n};\n\nconst ChatNoConversationContent: React.FC<{\n  buttonJoin?: React.ReactNode;\n}> = ({ buttonJoin }) => {\n  return (\n    <>\n      <Content>\n        {buttonJoin ? (\n          buttonJoin\n        ) : (\n          <WaitingMessageContainer>\n            <WaitingMessageEmoji>💭</WaitingMessageEmoji>\n            <WaitingMessageTitle>\n              En attente de conversation\n            </WaitingMessageTitle>\n            <WaitingMessageText>\n              La conversation n'est pas encore active. Revenez bientôt pour\n              discuter !\n            </WaitingMessageText>\n          </WaitingMessageContainer>\n        )}\n      </Content>\n    </>\n  );\n};\n\nexport const Chat: React.FC<\n  Omit<ChatProps, \"conversationId\"> & {\n    conversationId?: string | null;\n    buttonJoin?: React.ReactNode;\n  }\n> = (props) => {\n  const { conversationId, buttonJoin, ...rest } = props;\n\n  if (conversationId) {\n    return (\n      <ChatProvider {...rest} conversationId={conversationId}>\n        <ChatConversationContent />\n      </ChatProvider>\n    );\n  }\n\n  return <ChatNoConversationContent buttonJoin={buttonJoin} />;\n};\n","import { Attachment, ChatProps, User } from \"../../types/chat\";\nimport React, { useState } from \"react\";\n\nimport { Badge } from \"@mui/material\";\nimport ChatIcon from \"@mui/icons-material/Chat\";\nimport { ChatPopup } from \"../ChatPopup\";\nimport { FloatingButton } from \"../FloatingButton\";\n\nexport interface ChatBubbleProps {\n  onClick?: () => void;\n  unreadCount?: number;\n  color?: \"primary\" | \"secondary\";\n  title?: string;\n  renderParticipant?: (participant: User) => React.ReactNode;\n  allAttachments?: Attachment[];\n  conversationId?: string | null;\n  buttonJoin?: React.ReactNode;\n}\n\nexport const ChatBubble: React.FC<\n  ChatBubbleProps & Omit<ChatProps, \"conversationId\">\n> = ({\n  onClick,\n  unreadCount = 0,\n  color = \"primary\",\n  title = \"Chat\",\n  conversationId,\n  defaultMessages,\n  participants,\n  onReceiveMessage,\n  onSendMessage,\n  renderParticipant,\n  config,\n  isLoading,\n  onMessageSeen,\n  onLoadMoreMessages,\n  allAttachments,\n  totalMessages,\n  buttonJoin,\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n\n  const handleClick = () => {\n    setIsOpen(!isOpen);\n    onClick?.();\n  };\n\n  const icon =\n    unreadCount > 0 ? (\n      <Badge badgeContent={unreadCount} color=\"error\" max={99}>\n        <ChatIcon />\n      </Badge>\n    ) : (\n      <ChatIcon />\n    );\n  return (\n    <>\n      <FloatingButton\n        icon={icon}\n        onClick={handleClick}\n        color={color}\n        tooltip=\"Ouvrir le chat\"\n        sx={{\n          \"&:hover\": {\n            transform: \"scale(1.1)\",\n          },\n        }}\n      />\n      <ChatPopup\n        participants={participants}\n        renderParticipant={renderParticipant}\n        open={isOpen}\n        onClose={() => setIsOpen(false)}\n        title={title}\n        conversationId={conversationId}\n        defaultMessages={defaultMessages}\n        onReceiveMessage={onReceiveMessage}\n        onSendMessage={onSendMessage}\n        onMessageSeen={onMessageSeen}\n        config={config}\n        isLoading={isLoading}\n        onLoadMoreMessages={onLoadMoreMessages}\n        allAttachments={allAttachments}\n        totalMessages={totalMessages}\n        buttonJoin={buttonJoin}\n      />\n    </>\n  );\n};\n","import {\n  Attachment,\n  ChatConfig,\n  ChatProps,\n  Message,\n  OnSendMessage,\n  ReceiveMessage,\n  SendMessage,\n  User,\n} from \"../../types/chat\";\nimport React, { useEffect } from \"react\";\n\nimport { Chat } from \"../Chat\";\nimport Header from \"./components/Header\";\nimport { StyledPaper } from \"./style\";\n\ninterface ChatPopupProps {\n  open: boolean;\n  onClose: () => void;\n  title?: string;\n  avatar?: string;\n  allAttachments?: Attachment[];\n  renderParticipant?: (participant: User) => React.ReactNode;\n  onReceiveMessage?: (\n    eventId: string,\n    message: ReceiveMessage\n  ) => Promise<Message>;\n  onSendMessage: (props: OnSendMessage) => Promise<Message>;\n  onMessageSeen?: ({\n    lastMessage,\n    conversationId,\n    userId,\n  }: {\n    lastMessage: Message;\n    conversationId: string;\n    userId: string;\n  }) => void;\n  buttonJoin?: React.ReactNode;\n}\n\nexport const ChatPopup = ({\n  open,\n  onClose,\n  conversationId,\n  title = \"Chat\",\n  avatar,\n  defaultMessages,\n  participants,\n  onReceiveMessage,\n  onSendMessage,\n  config,\n  renderParticipant,\n  isLoading,\n  onMessageSeen,\n  onLoadMoreMessages,\n  allAttachments,\n  totalMessages,\n  buttonJoin,\n}: ChatPopupProps &\n  Omit<ChatProps, \"conversationId\"> & {\n    conversationId?: string | null;\n  }) => {\n  const [isClosing, setIsClosing] = React.useState(false);\n  const [isExpanded, setIsExpanded] = React.useState(false);\n\n  useEffect(() => {\n    if (!open) {\n      setIsClosing(true);\n      const timer = setTimeout(() => {\n        setIsClosing(false);\n      }, 300);\n      return () => clearTimeout(timer);\n    }\n  }, [open]);\n\n  return (\n    <StyledPaper\n      elevation={3}\n      isClosing={isClosing}\n      isExpanded={isExpanded}\n      style={{\n        display: !open && !isClosing ? \"none\" : \"flex\",\n        pointerEvents: !open && !isClosing ? \"none\" : \"auto\",\n      }}\n    >\n      <Header\n        title={title}\n        onClose={() => {\n          setIsClosing(true);\n          setTimeout(() => {\n            onClose();\n          }, 300);\n        }}\n        allAttachments={allAttachments}\n        onExpand={() => setIsExpanded(!isExpanded)}\n        isExpanded={isExpanded}\n        avatar={avatar}\n        conversationId={conversationId}\n        participants={participants}\n        renderParticipant={renderParticipant}\n      />\n      <Chat\n        config={config}\n        participants={participants}\n        isLoading={isLoading}\n        defaultMessages={defaultMessages}\n        conversationId={conversationId}\n        onReceiveMessage={onReceiveMessage}\n        onSendMessage={onSendMessage}\n        onMessageSeen={onMessageSeen}\n        onLoadMoreMessages={onLoadMoreMessages}\n        totalMessages={totalMessages}\n        buttonJoin={buttonJoin}\n      />\n    </StyledPaper>\n  );\n};\n","import { Attachment, Message, User } from \"../../../../types/chat\";\nimport { Box, IconButton, Typography } from \"@mui/material\";\nimport React, { useState } from \"react\";\n\nimport Close from \"@mui/icons-material/Close\";\nimport CloseFullscreen from \"@mui/icons-material/CloseFullscreen\";\nimport { DocumentsMenu } from \"./DocumentsMenu\";\nimport { HeaderMenu } from \"./HeaderMenu\";\nimport OpenInFull from \"@mui/icons-material/OpenInFull\";\nimport { ParticipantsMenu } from \"./ParticipantsMenu\";\nimport { styled } from \"@mui/material/styles\";\n\nconst HeaderContainer = styled(Box)(({ theme }) => ({\n  padding: theme.spacing(1.5),\n  borderBottom: `1px solid ${theme.palette.divider}`,\n  background: theme.palette.background.paper,\n  color: theme.palette.text.primary,\n  display: \"flex\",\n  justifyContent: \"space-between\",\n  alignItems: \"center\",\n  borderTopLeftRadius: \"16px\",\n  borderTopRightRadius: \"16px\",\n}));\n\nconst UserInfo = styled(Box)(({ theme }) => ({\n  display: \"flex\",\n  alignItems: \"center\",\n  gap: theme.spacing(1),\n}));\n\nconst UserAvatar = styled(Box)(({ theme }) => ({\n  width: 32,\n  height: 32,\n  borderRadius: \"50%\",\n  overflow: \"hidden\",\n  display: \"flex\",\n  alignItems: \"center\",\n  justifyContent: \"center\",\n  backgroundColor: theme.palette.primary.main,\n  color: theme.palette.primary.contrastText,\n  fontSize: \"0.9rem\",\n  fontWeight: 500,\n  \"& img\": {\n    width: \"100%\",\n    height: \"100%\",\n    objectFit: \"cover\",\n  },\n}));\n\nconst UserName = styled(Typography)(({ theme }) => ({\n  fontSize: \"0.9rem\",\n  fontWeight: 600,\n  margin: 0,\n  lineHeight: 1.2,\n}));\n\nconst ActionButton = styled(IconButton)(({ theme }) => ({\n  color: theme.palette.text.secondary,\n  padding: 0.5,\n  \"&:hover\": {\n    color: theme.palette.primary.main,\n  },\n}));\n\ninterface HeaderProps {\n  title: React.ReactNode;\n  onClose: () => void;\n  onExpand?: () => void;\n  isExpanded?: boolean;\n  avatar?: string;\n  participants?: User[];\n  renderParticipant?: (participant: User) => React.ReactNode;\n  allAttachments?: Attachment[];\n  conversationId?: string | null;\n}\n\nconst Header: React.FC<HeaderProps> = ({\n  title,\n  onClose,\n  onExpand,\n  isExpanded,\n  avatar,\n  participants = [],\n  renderParticipant,\n  allAttachments,\n  conversationId,\n}) => {\n  const [isDocumentsOpen, setIsDocumentsOpen] = useState(false);\n  const [isParticipantsOpen, setIsParticipantsOpen] = useState(false);\n\n  const handleDocumentClose = () => setIsDocumentsOpen(false);\n  const handleParticipantsClose = () => setIsParticipantsOpen(false);\n\n  const renderActionButtons = () => {\n    if (isExpanded && conversationId) {\n      return (\n        <>\n          <ActionButton size=\"small\" onClick={() => setIsDocumentsOpen(true)}>\n            <DocumentsMenu\n              allAttachments={allAttachments}\n              open={isDocumentsOpen}\n              onClose={handleDocumentClose}\n            />\n          </ActionButton>\n          <ActionButton\n            size=\"small\"\n            onClick={() => setIsParticipantsOpen(true)}\n          >\n            <ParticipantsMenu\n              participants={participants}\n              renderParticipant={renderParticipant}\n              open={isParticipantsOpen}\n              onClose={handleParticipantsClose}\n            />\n          </ActionButton>\n        </>\n      );\n    }\n\n    if (conversationId) {\n      return (\n        <HeaderMenu\n          allAttachments={allAttachments}\n          participants={participants}\n          renderParticipant={renderParticipant}\n        />\n      );\n    }\n\n    return null;\n  };\n\n  return (\n    <HeaderContainer>\n      <UserInfo>\n        {avatar && (\n          <UserAvatar>\n            <img src={avatar} alt={\"title\"} />\n          </UserAvatar>\n        )}\n        <Box>\n          <UserName variant=\"subtitle1\">{title}</UserName>\n        </Box>\n      </UserInfo>\n      <Box sx={{ display: \"flex\", gap: 1 }}>\n        {renderActionButtons()}\n        {onExpand && (\n          <ActionButton\n            onClick={onExpand}\n            size=\"small\"\n            sx={{\n              transform: isExpanded ? \"rotate(180deg)\" : \"none\",\n            }}\n          >\n            {isExpanded ? (\n              <CloseFullscreen fontSize=\"small\" />\n            ) : (\n              <OpenInFull fontSize=\"small\" />\n            )}\n          </ActionButton>\n        )}\n        <ActionButton onClick={onClose} size=\"small\">\n          <Close fontSize=\"small\" />\n        </ActionButton>\n      </Box>\n    </HeaderContainer>\n  );\n};\n\nexport default Header;\n","import { Box, IconButton, Typography } from \"@mui/material\";\r\nimport { MenuHeader, StyledList, StyledPopover } from \"./styles\";\r\nimport React, { useRef } from \"react\";\r\n\r\nimport { Attachment } from \"@/client/types/chat\";\r\nimport CloseIcon from \"@mui/icons-material/Close\";\r\nimport { FileItem } from \"@/client/components/FileManager\";\r\nimport InsertDriveFileIcon from \"@mui/icons-material/InsertDriveFile\";\r\n\r\ninterface DocumentsMenuProps {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  allAttachments?: Attachment[];\r\n}\r\n\r\nexport const DocumentsMenu: React.FC<DocumentsMenuProps> = ({\r\n  allAttachments,\r\n  open,\r\n  onClose,\r\n}) => {\r\n  const anchorRef = useRef<HTMLButtonElement>(null);\r\n\r\n  return (\r\n    <>\r\n      <IconButton\r\n        ref={anchorRef}\r\n        size=\"small\"\r\n        sx={{\r\n          color: (theme) => theme.palette.text.secondary,\r\n          padding: 0.5,\r\n          \"&:hover\": {\r\n            color: (theme) => theme.palette.primary.main,\r\n          },\r\n        }}\r\n      >\r\n        <InsertDriveFileIcon fontSize=\"small\" />\r\n      </IconButton>\r\n      <StyledPopover\r\n        open={open}\r\n        anchorEl={anchorRef.current}\r\n        onClose={onClose}\r\n        anchorOrigin={{\r\n          vertical: \"bottom\",\r\n          horizontal: \"right\",\r\n        }}\r\n        transformOrigin={{\r\n          vertical: \"top\",\r\n          horizontal: \"right\",\r\n        }}\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        <MenuHeader>\r\n          <Box sx={{ display: \"flex\", alignItems: \"center\", gap: 1 }}>\r\n            <InsertDriveFileIcon fontSize=\"small\" color=\"primary\" />\r\n            <Typography variant=\"subtitle2\" fontWeight=\"bold\">\r\n              Documents ({allAttachments?.length || 0})\r\n            </Typography>\r\n          </Box>\r\n          <IconButton size=\"small\" onClick={onClose}>\r\n            <CloseIcon fontSize=\"small\" />\r\n          </IconButton>\r\n        </MenuHeader>\r\n        <StyledList>\r\n          {allAttachments?.length === 0 ? (\r\n            <Box sx={{ p: 2, textAlign: \"center\" }}>\r\n              <Typography variant=\"body2\" color=\"text.secondary\">\r\n                Aucun document partagé dans cette conversation\r\n              </Typography>\r\n            </Box>\r\n          ) : (\r\n            allAttachments?.map((file: Attachment, index: number) => (\r\n              <FileItem key={index} file={file} />\r\n            ))\r\n          )}\r\n        </StyledList>\r\n      </StyledPopover>\r\n    </>\r\n  );\r\n};\r\n","import { Box, List, Popover } from \"@mui/material\";\r\nimport { BoxProps, ListProps, PopoverProps } from \"@mui/material\";\r\n\r\nimport { StyledComponent } from \"@emotion/styled\";\r\nimport { styled } from \"@mui/material/styles\";\r\n\r\nexport const StyledPopover: StyledComponent<PopoverProps> = styled(Popover)(({ theme }) => ({\r\n  \"& .MuiPaper-root\": {\r\n    width: 280,\r\n    maxHeight: 360,\r\n    backgroundColor: theme.palette.background.paper,\r\n    borderRadius: theme.shape.borderRadius,\r\n    boxShadow: theme.shadows[3],\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n  },\r\n}));\r\n\r\nexport const MenuHeader: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\r\n  padding: theme.spacing(1.5),\r\n  borderBottom: `1px solid ${theme.palette.divider}`,\r\n  display: \"flex\",\r\n  alignItems: \"center\",\r\n  justifyContent: \"space-between\",\r\n  gap: theme.spacing(1),\r\n  position: \"sticky\",\r\n  top: 0,\r\n  backgroundColor: theme.palette.background.paper,\r\n  zIndex: 1,\r\n}));\r\n\r\nexport const StyledList: StyledComponent<ListProps> = styled(List)(({ theme }) => ({\r\n  flex: 1,\r\n  overflow: \"auto\",\r\n  py: 0,\r\n})); ","import { Box, BoxProps } from \"@mui/material\";\r\n\r\nimport { StyledComponent } from \"@emotion/styled\";\r\nimport { styled } from \"@mui/material/styles\";\r\n\r\nexport const FileContainer: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\r\n  display: \"flex\",\r\n  flexDirection: \"column\",\r\n  gap: theme.spacing(1),\r\n  padding: theme.spacing(1),\r\n  backgroundColor: theme.palette.background.default,\r\n  borderRadius: theme.shape.borderRadius,\r\n  border: `1px solid ${theme.palette.divider}`,\r\n  cursor: \"pointer\",\r\n  \"&:hover\": {\r\n    backgroundColor: theme.palette.action.hover,\r\n  },\r\n})); ","import { isAudio, isImage } from \"../../utils/fileUtils\";\r\n\r\nimport { AudioMessage } from \"../Chat/components/MessageList/AudioMessage\";\r\nimport { FileContainer } from \"./styles\";\r\nimport { ImageFile } from \"../Chat/components/MessageList/ImageFile\";\r\nimport React from \"react\";\r\nimport { RegularFile } from \"../Chat/components/MessageList/RegularFile\";\r\n\r\nexport interface File {\r\n  url: string;\r\n  name: string;\r\n  type: string;\r\n  size: number;\r\n}\r\n\r\ninterface FileItemProps {\r\n  file: File;\r\n  onClick?: (file: File) => void;\r\n}\r\n\r\nexport const FileItem: React.FC<FileItemProps> = ({ file, onClick }) => {\r\n  const handleClick = (e: React.MouseEvent) => {\r\n    // Si c'est un fichier audio, on ne fait rien au clic sur le conteneur\r\n    if (isAudio(file.name)) {\r\n      return;\r\n    }\r\n\r\n    if (onClick) {\r\n      onClick(file);\r\n    } else {\r\n      window.open(file.url, \"_blank\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <FileContainer onClick={handleClick}>\r\n      {isImage(file.name) ? (\r\n        <ImageFile url={file.url} name={file.name} />\r\n      ) : isAudio(file.name) ? (\r\n        <AudioMessage url={file.url} />\r\n      ) : (\r\n        <RegularFile url={file.url} name={file.name} />\r\n      )}\r\n    </FileContainer>\r\n  );\r\n};\r\n","import { Attachment, Message, User } from \"../../../../types/chat\";\nimport {\n  Box,\n  IconButton,\n  Menu,\n  MenuItem,\n  Tooltip,\n  Typography,\n} from \"@mui/material\";\nimport React, { useState } from \"react\";\n\nimport { DocumentsMenu } from \"./DocumentsMenu\";\nimport MoreVertIcon from \"@mui/icons-material/MoreVert\";\nimport { ParticipantsMenu } from \"./ParticipantsMenu\";\n\ninterface HeaderMenuProps {\n  allAttachments?: Attachment[];\n  participants: User[];\n  renderParticipant?: (participant: User) => React.ReactNode;\n}\n\nexport const HeaderMenu: React.FC<HeaderMenuProps> = ({\n  participants,\n  renderParticipant,\n  allAttachments,\n}) => {\n  const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null);\n  const [isDocumentsOpen, setIsDocumentsOpen] = useState(false);\n  const [isParticipantsOpen, setIsParticipantsOpen] = useState(false);\n  const open = Boolean(anchorEl);\n\n  const handleClick = (event: React.MouseEvent<HTMLElement>) => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleClose = () => {\n    setAnchorEl(null);\n    setIsDocumentsOpen(false);\n    setIsParticipantsOpen(false);\n  };\n\n  const handleDocumentClick = (e: React.MouseEvent) => {\n    setIsDocumentsOpen(true);\n    setIsParticipantsOpen(false);\n  };\n\n  const handleParticipantsClick = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    setIsParticipantsOpen(true);\n    setIsDocumentsOpen(false);\n  };\n\n  const handleDocumentClose = () => {\n    setIsDocumentsOpen(false);\n  };\n\n  const handleParticipantsClose = () => {\n    setIsParticipantsOpen(false);\n  };\n\n  return (\n    <>\n      <Tooltip title=\"Options\">\n        <IconButton\n          onClick={handleClick}\n          size=\"small\"\n          sx={{\n            color: (theme) => theme.palette.text.secondary,\n            padding: 0.5,\n            \"&:hover\": {\n              color: (theme) => theme.palette.primary.main,\n            },\n          }}\n        >\n          <MoreVertIcon fontSize=\"small\" />\n        </IconButton>\n      </Tooltip>\n      <Menu\n        anchorEl={anchorEl}\n        open={open}\n        onClose={handleClose}\n        anchorOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"right\",\n        }}\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"right\",\n        }}\n        onClick={(e) => e.stopPropagation()}\n      >\n        <MenuItem onClick={handleDocumentClick}>\n          <DocumentsMenu\n            allAttachments={allAttachments}\n            open={isDocumentsOpen}\n            onClose={handleDocumentClose}\n          />\n          <Typography variant=\"body2\">Documents</Typography>\n        </MenuItem>\n        <MenuItem onClick={handleParticipantsClick}>\n          <ParticipantsMenu\n            participants={participants}\n            renderParticipant={renderParticipant}\n            open={isParticipantsOpen}\n            onClose={handleParticipantsClose}\n          />\n          <Typography variant=\"body2\">Participants</Typography>\n        </MenuItem>\n      </Menu>\n    </>\n  );\n};\n","import {\r\n  Box,\r\n  IconButton,\r\n  ListItemIcon,\r\n  ListItemText,\r\n  Typography,\r\n} from \"@mui/material\";\r\nimport {\r\n  MenuHeader,\r\n  ParticipantAvatar,\r\n  StyledList,\r\n  StyledListItem,\r\n  StyledPopover,\r\n} from \"./styles\";\r\nimport React, { useRef } from \"react\";\r\n\r\nimport GroupIcon from \"@mui/icons-material/Group\";\r\nimport { User } from \"@/client/types/chat\";\r\n\r\ninterface ParticipantsMenuProps {\r\n  participants: User[];\r\n  renderParticipant?: (participant: User) => React.ReactNode;\r\n  open: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport const ParticipantsMenu: React.FC<ParticipantsMenuProps> = ({\r\n  participants,\r\n  renderParticipant,\r\n  open,\r\n  onClose,\r\n}) => {\r\n  const anchorRef = useRef<HTMLButtonElement>(null);\r\n\r\n  return (\r\n    <>\r\n      <IconButton\r\n        ref={anchorRef}\r\n        size=\"small\"\r\n        sx={{\r\n          color: (theme) => theme.palette.text.secondary,\r\n          padding: 0.5,\r\n          \"&:hover\": {\r\n            color: (theme) => theme.palette.primary.main,\r\n          },\r\n        }}\r\n      >\r\n        <GroupIcon fontSize=\"small\" />\r\n      </IconButton>\r\n      <StyledPopover\r\n        open={open}\r\n        anchorEl={anchorRef.current}\r\n        onClose={onClose}\r\n        anchorOrigin={{\r\n          vertical: \"bottom\",\r\n          horizontal: \"right\",\r\n        }}\r\n        transformOrigin={{\r\n          vertical: \"top\",\r\n          horizontal: \"right\",\r\n        }}\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        <MenuHeader>\r\n          <Box sx={{ display: \"flex\", alignItems: \"center\", gap: 1 }}>\r\n            <GroupIcon fontSize=\"small\" color=\"primary\" />\r\n            <Typography variant=\"subtitle2\" fontWeight=\"bold\">\r\n              Participants ({participants.length})\r\n            </Typography>\r\n          </Box>\r\n        </MenuHeader>\r\n        <StyledList>\r\n          {participants.map((participant) => (\r\n            <StyledListItem key={participant.id}>\r\n              <ListItemIcon sx={{ minWidth: 36 }}>\r\n                {renderParticipant ? (\r\n                  renderParticipant(participant)\r\n                ) : (\r\n                  <ParticipantAvatar>\r\n                    <Typography\r\n                      variant=\"caption\"\r\n                      sx={{ fontSize: \"0.9rem\", fontWeight: 500 }}\r\n                    >\r\n                      {participant.name\r\n                        .split(\" \")\r\n                        .map((word) => word[0])\r\n                        .join(\"\")\r\n                        .toUpperCase()\r\n                        .slice(0, 2)}\r\n                    </Typography>\r\n                  </ParticipantAvatar>\r\n                )}\r\n              </ListItemIcon>\r\n              <ListItemText\r\n                primary={\r\n                  <Typography variant=\"body2\" fontWeight={500}>\r\n                    {participant.name}\r\n                  </Typography>\r\n                }\r\n              />\r\n            </StyledListItem>\r\n          ))}\r\n        </StyledList>\r\n      </StyledPopover>\r\n    </>\r\n  );\r\n};\r\n","import { Box, List, ListItem, Popover } from \"@mui/material\";\r\nimport { BoxProps, ListItemProps, ListProps, PopoverProps } from \"@mui/material\";\r\n\r\nimport { StyledComponent } from \"@emotion/styled\";\r\nimport { styled } from \"@mui/material/styles\";\r\n\r\nexport const StyledPopover: StyledComponent<PopoverProps> = styled(Popover)(({ theme }) => ({\r\n  \"& .MuiPaper-root\": {\r\n    width: 280,\r\n    maxHeight: 360,\r\n    backgroundColor: theme.palette.background.paper,\r\n    borderRadius: theme.shape.borderRadius,\r\n    boxShadow: theme.shadows[3],\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n  },\r\n}));\r\n\r\nexport const MenuHeader: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\r\n  padding: theme.spacing(1.5),\r\n  borderBottom: `1px solid ${theme.palette.divider}`,\r\n  display: \"flex\",\r\n  alignItems: \"center\",\r\n  justifyContent: \"space-between\",\r\n  gap: theme.spacing(1),\r\n  position: \"sticky\",\r\n  top: 0,\r\n  backgroundColor: theme.palette.background.paper,\r\n  zIndex: 1,\r\n}));\r\n\r\nexport const ParticipantAvatar: StyledComponent<BoxProps> = styled(Box)(({ theme }) => ({\r\n  width: 32,\r\n  height: 32,\r\n  borderRadius: \"50%\",\r\n  overflow: \"hidden\",\r\n  display: \"flex\",\r\n  alignItems: \"center\",\r\n  justifyContent: \"center\",\r\n  backgroundColor: theme.palette.primary.main,\r\n  color: theme.palette.primary.contrastText,\r\n  fontSize: \"0.9rem\",\r\n  fontWeight: 500,\r\n  \"& img\": {\r\n    width: \"100%\",\r\n    height: \"100%\",\r\n    objectFit: \"cover\",\r\n  },\r\n}));\r\n\r\nexport const StyledListItem: StyledComponent<ListItemProps> = styled(ListItem)(({ theme }) => ({\r\n  padding: theme.spacing(0.75, 1.5),\r\n  \"&:hover\": {\r\n    backgroundColor: theme.palette.action.hover,\r\n  },\r\n}));\r\n\r\nexport const StyledList: StyledComponent<ListProps> = styled(List)(({ theme }) => ({\r\n  flex: 1,\r\n  overflow: \"auto\",\r\n  py: 0,\r\n})); ","import { Paper, PaperProps } from \"@mui/material\";\n\nimport { StyledComponent } from \"@emotion/styled\";\nimport { styled } from \"@mui/material/styles\";\n\nexport const StyledPaper: StyledComponent<PaperProps & { isClosing: boolean; isExpanded: boolean }> = styled(Paper, {\n  shouldForwardProp: (prop) => prop !== \"isClosing\" && prop !== \"isExpanded\",\n})<PaperProps & { isClosing: boolean; isExpanded: boolean }>(\n  ({ theme, isClosing, isExpanded }) => ({\n    position: \"fixed\",\n    bottom: theme.spacing(12),\n    right: theme.spacing(4),\n    width: isExpanded ? \"80%\" : 350,\n    height: isExpanded ? \"80vh\" : 500,\n    zIndex: 1000,\n    display: \"flex\",\n    flexDirection: \"column\",\n    gap: theme.spacing(1),\n    overflow: \"hidden\",\n    transformOrigin: \"bottom right\",\n    borderRadius: \"16px\",\n    boxShadow: `\n      0 8px 32px rgba(0, 0, 0, 0.1),\n      0 0 0 1px ${theme.palette.primary.dark}33,\n      0 0 0 2px ${theme.palette.primary.dark}11\n    `,\n    border: `1px solid ${theme.palette.primary.dark}33`,\n    backdropFilter: \"blur(10px)\",\n    background: `linear-gradient(180deg, \n      ${theme.palette.background.paper} 0%, \n      ${theme.palette.background.paper} 100%\n    )`,\n    transition: \"all 0.3s ease-in-out\",\n    transform: isClosing ? \"scale(0.95) translateY(20px)\" : \"scale(1)\",\n    opacity: isClosing ? 0 : 1,\n    visibility: isClosing ? \"hidden\" : \"visible\",\n    animation: !isClosing ? \"popIn 0.3s ease-out\" : \"none\",\n    \"&.loading\": {\n      overflow: \"hidden\",\n    },\n    \"@keyframes popIn\": {\n      \"0%\": {\n        transform: \"scale(0.95) translateY(20px)\",\n        opacity: 0,\n      },\n      \"100%\": {\n        transform: \"scale(1) translateY(0)\",\n        opacity: 1,\n      },\n    },\n  })\n);\n","import { SxProps, Theme, Zoom, useTheme } from \"@mui/material\";\r\n\r\nimport React from \"react\";\r\nimport { StyledFab } from \"./styles\";\r\n\r\nexport interface FloatingButtonProps {\r\n  icon: React.ReactNode;\r\n  onClick?: () => void;\r\n  color?:\r\n    | \"primary\"\r\n    | \"secondary\"\r\n    | \"default\"\r\n    | \"success\"\r\n    | \"error\"\r\n    | \"info\"\r\n    | \"warning\";\r\n  size?: \"small\" | \"medium\" | \"large\";\r\n  sx?: SxProps<Theme>;\r\n  tooltip?: string;\r\n}\r\n\r\nexport const FloatingButton: React.FC<FloatingButtonProps> = ({\r\n  icon,\r\n  onClick,\r\n  color = \"primary\",\r\n  size = \"large\",\r\n  sx,\r\n  tooltip,\r\n}) => {\r\n  const theme = useTheme();\r\n\r\n  return (\r\n    <Zoom\r\n      in={true}\r\n      timeout={{\r\n        enter: 225,\r\n        exit: 195,\r\n      }}\r\n      style={{\r\n        transitionDelay: \"0ms\",\r\n      }}\r\n      unmountOnExit\r\n    >\r\n      <StyledFab\r\n        onClick={onClick}\r\n        color={color}\r\n        size={size}\r\n        aria-label={tooltip}\r\n        sx={sx}\r\n      >\r\n        {icon}\r\n      </StyledFab>\r\n    </Zoom>\r\n  );\r\n};\r\n","import { Fab } from \"@mui/material\";\r\nimport { FabProps } from \"@mui/material/Fab\";\r\nimport { StyledComponent } from \"@emotion/styled\";\r\nimport { styled } from \"@mui/material/styles\";\r\n\r\nexport const StyledFab: StyledComponent<FabProps> = styled(Fab)(({ theme }) => ({\r\n  position: \"fixed\",\r\n  bottom: theme.spacing(4),\r\n  right: theme.spacing(4),\r\n  zIndex: 1000,\r\n})); "],"mappings":"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","names":["Pusher","pusher","POST","POST","useEffect","pusher","Pusher","pusher","pusher","Pusher","pusher","useEffect","subscription","useEffect","useRef","uuidv4","pusher","useRef","useEffect","subscription","React","createContext","useCallback","useContext","useEffect","useRef","jsx","createContext","useContext","React","useRef","useEffect","userId","useCallback","Box","styled","useEffect","useState","jsx","useState","useEffect","Box","Button","styled","useRef","jsx","Box","styled","useEffect","useRef","useState","Box","Button","Box","useState","jsx","Box","jsx","Box","IconButton","useRef","useState","jsx","jsxs","Box","CircularProgress","IconButton","useRef","useState","jsx","jsxs","formatTime","jsx","jsxs","useRef","useState","useEffect","Box","Button","Box","CircularProgress","Typography","Box","styled","Box","Link","Typography","Box","styled","Box","IconButton","Typography","useRef","useState","jsx","jsxs","Typography","IconButton","React","jsx","jsxs","IconButton","React","jsx","jsxs","Typography","Box","jsx","jsxs","Box","jsx","React","jsx","jsxs","Link","Box","Typography","React","Box","Tooltip","Typography","Box","styled","jsx","jsxs","Box","Typography","Tooltip","Tooltip","React","jsx","moment","jsx","jsxs","moment","React","Box","CircularProgress","Typography","Typography","useEffect","useState","Box","styled","jsx","useState","useEffect","Typography","Fragment","jsx","jsxs","useState","React","useEffect","Box","IconButton","Typography","useState","Box","IconButton","Typography","Box","Popover","styled","useRef","CloseIcon","Box","styled","FileContainer","jsx","FileContainer","InsertDriveFileIcon","Fragment","jsx","jsxs","useRef","IconButton","Box","Typography","CloseIcon","IconButton","Tooltip","Typography","useState","Box","IconButton","Typography","Box","List","Popover","styled","StyledPopover","MenuHeader","StyledList","useRef","Fragment","jsx","jsxs","IconButton","StyledPopover","MenuHeader","Box","Typography","StyledList","Fragment","jsx","jsxs","useState","Tooltip","IconButton","Typography","styled","Fragment","jsx","jsxs","Box","UserAvatar","Typography","IconButton","useState","styled","jsx","jsxs","React","useEffect","styled","jsx","Fragment","jsx","jsxs","useState"]}